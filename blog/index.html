<!DOCTYPE html><html><head><link href="/images/favicon.png" rel="icon" type="image/png" /><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="ROM &raquo; Blog via @rom_rb" name="twitter:description" /><meta content="ROM &raquo; Blog" name="description" /><title>ROM &raquo; Blog</title><style type="text/css">.highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #d0d0d0;
  background-color: #151515;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}</style><link href="../stylesheets/all.css" rel="stylesheet" /><script src="../javascripts/all.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script><script>$(function() {
  var share = new Share(".share")
});
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-2573270-5', 'auto');
ga('send', 'pageview');</script></head><body class="blog blog_index"><div class="page-wrapper"><header><nav class="navbar navbar-default navbar-static-top"><div class="navbar-inner"><div class="container"><a class="navbar-brand" href="/">Ruby Object Mapper</a><ul class="nav navbar-nav"><li class=""><a class="" href="/learn">Learn</a></li><li class="dropdown"><a class="dropdown-toggle" role="button" data-toggle="dropdown" href="#">API <span class='caret'/></a><ul class="dropdown-menu" role="menu"><li><a href="http://www.rubydoc.info/gems/rom">rom</a></li><li><a href="http://www.rubydoc.info/gems/rom-cassandra">rom-cassandra</a></li><li><a href="http://www.rubydoc.info/gems/rom-couchdb">rom-couchdb</a></li><li><a href="http://www.rubydoc.info/gems/rom-csv">rom-csv</a></li><li><a href="http://www.rubydoc.info/gems/rom-dm">rom-dm</a></li><li><a href="http://www.rubydoc.info/gems/rom-event_store">rom-event_store</a></li><li><a href="http://www.rubydoc.info/gems/rom-git">rom-git</a></li><li><a href="http://www.rubydoc.info/gems/rom-http">rom-http</a></li><li><a href="http://www.rubydoc.info/gems/rom-influxdb">rom-influxdb</a></li><li><a href="http://www.rubydoc.info/gems/rom-json">rom-json</a></li><li><a href="http://www.rubydoc.info/gems/rom-kafka">rom-kafka</a></li><li><a href="http://www.rubydoc.info/gems/rom-lotus">rom-lotus</a></li><li><a href="http://www.rubydoc.info/gems/rom-mongo">rom-mongo</a></li><li><a href="http://www.rubydoc.info/gems/rom-neo4j">rom-neo4j</a></li><li><a href="http://www.rubydoc.info/gems/rom-rails">rom-rails</a></li><li><a href="http://www.rubydoc.info/gems/rom-redis">rom-redis</a></li><li><a href="http://www.rubydoc.info/gems/rom-rethinkdb">rom-rethinkdb</a></li><li><a href="http://www.rubydoc.info/gems/rom-roda">rom-roda</a></li><li><a href="http://www.rubydoc.info/gems/rom-sql">rom-sql</a></li><li><a href="http://www.rubydoc.info/gems/rom-yaml">rom-yaml</a></li><li><a href="http://www.rubydoc.info/gems/rom-yesql">rom-yesql</a></li></ul></li><li class="active"><a class="active" href="/blog">Blog</a></li><li class=""><a class="" href="/contribute">Contribute</a></li><li class=""><a class="" href="/status">Status</a></li><li class=""><a class="" href="/backers">Backers <3</a></li></ul></div></div></nav></header><div class="container"><div class="content"><div class="blog"><div class="row"><div class="col-md-8"><section class="articles"><article><header><h1><a href="/blog/2016/01/06/rom-1-0-0-released">ROM 1.0.0 Released</a></h1><div class="article-meta">Published on January 06, 2016 by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> under <a class="tag" href="/blog/tags/announcement/">announcement</a></div></header><hr /><div class="article-body"><p>We&rsquo;re happy to announce the first stable release of <code>rom</code> core gem. It took us
a little over a year to discover and implement the core interfaces that allow
building rom adapters and extensions. Since no significant changes had to be made
for many months and there are no outstanding issues - <code>rom 1.0.0</code> is now available.</p>

<p>Following gems have been updated and released:</p>

<ul>
<li>rom 1.0.0 <a href="https://github.com/rom-rb/rom/blob/master/CHANGELOG.md#v100-2016-01-06">CHANGELOG</a></li>
<li>rom-support 1.0.0 <a href="https://github.com/rom-rb/rom-support/blob/master/CHANGELOG.md#v100-2016-01-06">CHANGELOG</a></li>
<li>rom-mapper 0.3.0 <a href="https://github.com/rom-rb/rom-mapper/blob/master/CHANGELOG.md#v030-2016-01-06">CHANGELOG</a></li>
<li>rom-model 0.2.0 <a href="https://github.com/rom-rb/rom-model/blob/master/CHANGELOG.md#v020-2016-01-06">CHANGELOG</a></li>
<li>rom-rails 0.6.0 <a href="https://github.com/rom-rb/rom-rails/blob/master/CHANGELOG.md#v060-2016-01-06">CHANGELOG</a></li>
<li>rom-sql 0.7.0 <a href="https://github.com/rom-rb/rom-sql/blob/master/CHANGELOG.md#v070-2016-01-06">CHANGELOG</a></li>
<li>rom-repository 0.2.0 <a href="https://github.com/rom-rb/rom-repository/blob/master/CHANGELOG.md#v020-2016-01-06">CHANGELOG</a></li>
</ul>

<h2 id="what-does-this-release-mean">What Does This Release Mean?</h2>

<p>This is a huge milestone even though it doesn&rsquo;t change a lot from the usage point
of view. Having a stable set of core interfaces will make it easier to develop
adapters and extensions and get them to a stable state, too. Up until now every
ROM release was huge, including lots of changes in many places, multiple gems
were released at the same time. These kind of releases are hard to manage and it&rsquo;s
also difficult to provide information about individual changes and improvements
without overwhelming current users and potential new users.</p>

<p>Now, with the stable rom core, we can focus on individual adapters and extensions.
Release them separately, and probably more often. It will also make it simpler
to explain and document changes and improvements.</p>

<h2 id="what-happens-next">What Happens Next?</h2>

<p>First of all, we&rsquo;re working on updating <a href="http://rom-rb.org">rom-rb.org</a>, which will
have <a href="https://github.com/rom-rb/rom-rb.org/issues/111">a new design</a> and content -
as the documentation is currently being rewritten. The initial set of docs was too
focused on shared, lower-level APIs, mixed with adapter-specific APIs, which was
confusing. New docs will focus on high-level guides specific to individual adapters,
so it will be much easier to understand how to use ROM in a specific context.</p>

<p>As far as individual gems go, here&rsquo;s a rough plan:</p>

<ul>
<li><a href="https://github.com/rom-rb/rom">rom</a>

<ul>
<li>Relation schema support that can be used by commands and for migrations</li>
<li>Shared database migration interfaces for all adapters</li>
</ul></li>
<li><a href="https://github.com/rom-rb/rom-sql">rom-sql</a>

<ul>
<li>Improvements in the query DSL, especially when it comes to building
complex joins. We&rsquo;re still using Sequel but that may be changed in the near future.</li>
<li>Support for prepared statements</li>
<li>Built-in types for relation schemas specific to individual databases</li>
</ul></li>
<li><a href="https://github.com/rom-rb/rom-repository">rom-repository</a>

<ul>
<li>Support for commands</li>
<li>Setup interface, that would make it simple to quickly configure gateway
connection and fetch data</li>
<li>Support for dry-data structs and values</li>
</ul></li>
<li><a href="https://github.com/rom-rb/rom-model">rom-model</a>

<ul>
<li><code>ActiveModel::Validations</code> will be replaced by <a href="https://github.com/dryrb/dry-validation">dry-validation</a></li>
<li><code>ROM::Model::Attributes</code> will be deprecated in favor of dry-validation schemas</li>
</ul></li>
<li><a href="https://github.com/rom-rb/rom-rails">rom-rails</a>

<ul>
<li>Rewrite on top of <a href="https://github.com/dryrb/dry-component">dry-component</a></li>
<li><code>ROM::Model::Form</code> will be deprecated</li>
</ul></li>
</ul>

<p>Apart from these improvements, there will be smaller clean ups, refactorings and
performance tweaks.</p>

<p>The following adapters are looking for contributors and/or maintainers:</p>

<ul>
<li><a href="https://github.com/rom-rb/rom-rethinkdb">rom-rethinkdb</a></li>
<li><a href="https://github.com/rom-rb/rom-influxdb">rom-influxdb</a></li>
<li><a href="https://github.com/rom-rb/rom-mongo">rom-mongo</a></li>
<li><a href="https://github.com/rom-rb/rom-redis">rom-redis</a></li>
<li><a href="https://github.com/rom-rb/rom-neo4j">rom-neo4j</a></li>
<li><a href="https://github.com/rom-rb/rom-json">rom-json</a></li>
<li><a href="https://github.com/rom-rb/rom-csv">rom-csv</a></li>
<li><a href="https://github.com/rom-rb/rom-git">rom-git</a></li>
<li><a href="https://github.com/rom-rb/rom-http">rom-http</a></li>
<li><a href="https://github.com/rom-rb/rom-event_store">rom-event_store</a></li>
</ul>

<p>Please get in touch if your&rsquo;re interested in helping out :)</p>

<h2 id="towards-rom-2-0-stable-adapters-and-repository">Towards rom 2.0, Stable Adapters and Repository</h2>

<p>Further development of adapters and repository will very likely require changes
in some of the core public APIs. Expect an evolution though, not a revolution.
Some features will be introduced during 1.x.y upgrades, like relation schema, but
any public API change will require a major version bump since rom follows SemVer.
It&rsquo;s probably safe to assume this will happen later this year.</p>

<p><code>rom</code> 2.0.0 will be a base for the first stable releases of individual adapters and
extensions. That&rsquo;s why it is so important to focus on other adapters, not just
<code>rom-sql</code>, to see what kind of improvements are needed and whether it&rsquo;s going to
break any public APIs.</p>

<h2 id="providing-feedback-and-reporting-issues">Providing Feedback And Reporting Issues</h2>

<p>If you have found an issue or you&rsquo;re seeking help, there are number of ways you
can get in touch:</p>

<ul>
<li>Report <a href="https://github.com/rom-rb/rom/issues">an issue</a> on GitHub, preferably
in the issue tracker for the specific rom project. If you&rsquo;re not sure which one
it is - don&rsquo;t worry and report it in the main rom issue tracker</li>
<li>Ask for help in <a href="https://gitter.im/rom-rb/chat">the gitter channel</a></li>
<li>Post a message <a href="http://discuss.rom-rb.org">on our forum</a></li>
</ul>

<p>If you&rsquo;ve got feedback regarding documentation and/or the website, please report
an issue in <a href="https://github.com/rom-rb/rom-rb.org/issues">the rom-rb.org</a> repo.</p>

<h2 id="thank-you">Thank You!</h2>

<p>I&rsquo;d like to use this opportunity to simply say &ldquo;Thank You!&rdquo; to everybody involved
with the project. Many people have been supporting ROM in various ways, either
by contributing bug fixes, adding features or making huge refactorings. There
are also many people who have been very helpful in the gitter channel, providing
support for others who were trying out ROM.</p>

<p>Really special thanks go to early adopters and contributors:</p>

<ul>
<li><a href="https://github.com/aflatter">Alexander Flatter</a> - for adopting rom very early,
helping with API design, contributing code and supporting users in the channel</li>
<li><a href="https://github.com/nepalez">Andrew Kozin</a> - for helping with rom-mapper, creating
rom-migrator, rom-cassandra and rom-kafka</li>
<li><a href="https://github.com/AMHOL">Andy Holland</a> - for helping with rom core, creating
rom-http and being supportive in the channel</li>
<li><a href="https://github.com/cflipse">Chris Flipse</a> - who helped by providing patches
and helping me with rom-rails and rom-yaml</li>
<li><a href="https://github.com/endash">Christopher Swasey</a> - for his insane effort to refactor
and improve rom setup interfaces</li>
<li><a href="https://github.com/elskwid">Don Morrison</a> - for supporting me in the very early
days of ROM, helping with adapter interface, documentation, rom-rb website and
release announcements</li>
<li><a href="https://github.com/kwando">Hannes Nevalainen</a> - for testing things out early,
providing awesome feedback and contributing to different rom projects</li>
<li><a href="https://github.com/maetl">Mark Rickerby</a> - who built rom-neo4j and helped with
other projects, rom-rb website and release announcements</li>
<li><a href="https://github.com/gotar">Oskar Szrajer</a> - who helped a lot with rom-sql, rom-yesql,
other adapters and patches in multiple rom projects as well as helped promoting
rom at local Ruby meetups AND by providing support in our gitter channel</li>
<li><a href="https://github.com/splattael">Peter Suschlik</a> - for helping with performance
improvements, support libs and helping with PRs. Peter is currently #3 comitter :)</li>
<li><a href="https://github.com/robinetmiller">Robin Miller</a> - for helping with the new
documentation and providing great feedback</li>
</ul>

<p>I&rsquo;m terribly sorry if I missed somebody! Thank you <em>so much</em> for helping with this
enormous effort!</p>

<p>Happy 2016 :)</p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2016/01/06/rom-1-0-0-released#disqus_thread">Leave a comment</a></li></ul></div><hr /></div></article><article><header><h1><a href="/blog/2015/12/28/rom-1-0-0-rc-released">ROM 1.0.0 RC Released</a></h1><div class="article-meta">Published on December 28, 2015 by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> under <a class="tag" href="/blog/tags/announcement/">announcement</a></div></header><hr /><div class="article-body"><p>Today the first, and hopefully last, Release Candidate version of ROM 1.0.0 was released. If you&rsquo;re running on beta or older versions now it&rsquo;s a really good moment to upgrade. This release only includes one <a href="https://github.com/rom-rb/rom/issues/311">small bug fix</a>.</p>

<p>For more information please refer to the <a href="/blog/2015/11/24/first-beta-of-rom-1-0-0-has-been-released/">previous announcement</a>.</p>

<p>As part of this release other gems have been upgraded too:</p>

<ul>
<li>rom 1.0.0.rc1</li>
<li>rom-support 1.0.0.rc1</li>
<li>rom-mapper 0.3.0.rc1</li>
<li>rom-model 0.2.0.rc1</li>
<li>rom-rails 0.6.0.rc1</li>
<li>rom-sql 0.7.0.rc1</li>
<li>rom-repository 0.2.0.rc1</li>
</ul>

<p>These are pre-releases which means you need to add them explicitly to your Gemfile. If you&rsquo;re having problem with upgrading <a href="https://github.com/rom-rb/rom/issues">report an issue</a>, ask for help on <a href="https://gitter.im/rom-rb/chat">gitter</a> or post a message on <a href="http://discuss.rom-rb.org">the forum</a>.</p>

<p>The final version should be released on Wednesday, December 30th, unless we find some blocking issues which are hard to fix.</p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2015/12/28/rom-1-0-0-rc-released#disqus_thread">Leave a comment</a></li></ul></div><hr /></div></article><article><header><h1><a href="/blog/2015/11/24/first-beta-of-rom-1-0-0-has-been-released">First Beta of ROM 1.0.0 Has Been Released</a></h1><div class="article-meta">Published on November 24, 2015 by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> under <a class="tag" href="/blog/tags/announcement/">announcement</a></div></header><hr /><div class="article-body"><p>Exactly a year ago ROM 0.3.0 was released after <a href="http://solnic.eu/2014/10/23/ruby-object-mapper-reboot.html">the reboot of the project was announced</a>, it was a complete rewrite that introduced the new and simplified adapter interface. Since then we&rsquo;ve come a long way, the community has been growing, rom-rb organization on Github has now 28 projects including 16 adapters.</p>

<p>The core API, which also includes adapter interface, is stabilizing. This means we are coming very close to releasing the final version of rom 1.0.0 and today I&rsquo;m very happy to announce that its first beta1 was released. Please notice this is the release of the core rom gem - adapters and other extensions remain unstable (in the sem-ver sense).</p>

<p>To ease testing we also released beta versions of minor upgrades of other rom gems so that you can install them from rubygems rather than relying on github sources. Overall the release includes following updates:</p>

<ul>
<li><a href="https://rubygems.org/gems/rom">rom</a> 1.0.0.beta1 <a href="https://github.com/rom-rb/rom/blob/master/CHANGELOG.md#v100-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-support">rom-support</a> 1.0.0.beta1 <a href="https://github.com/rom-rb/rom-support/blob/master/CHANGELOG.md#v100-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-mapper">rom-mapper</a> 0.3.0.beta1 <a href="https://github.com/rom-rb/rom-mapper/blob/master/CHANGELOG.md#v030-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-repository">rom-repository</a> 0.2.0.beta1 <a href="https://github.com/rom-rb/rom-repository/blob/master/CHANGELOG.md#v020-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-sql">rom-sql</a> 0.7.0.beta1 <a href="https://github.com/rom-rb/rom-sql/blob/master/CHANGELOG.md#v070-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-rails">rom-rails</a> 0.6.0.beta1 <a href="https://github.com/rom-rb/rom-rails/blob/master/CHANGELOG.md#v060-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-model">rom-model</a> 0.2.0.beta1 <a href="https://github.com/rom-rb/rom-model/blob/master/CHANGELOG.md#020-to-be-released">CHANGELOG</a></li>
</ul>

<h2 id="changes-in-setup-api">Changes In Setup API</h2>

<p>Setting up ROM has been refactored and specific responsibilites have been broken down into smaller, and explicit, objects. Unfortunately it is a breaking change as <code>ROM.setup</code> method is gone. If you&rsquo;re using ROM with rails, things should continue to work, but if you have a custom rom setup additional actions are required.</p>

<p>This was an important change that resulted in a cleaner API, removed complex logic that used to rely on <code>inheritance</code> hooks to automatically register components and reduced the amount of global state that ROM relies on.</p>

<p>We kept convenience in mind though and introduced a feature that uses dir/file structure to infer components and register them automatically but without the complexity of relying on <code>inheritance</code> hooks.</p>

<p>Here&rsquo;s an example of a step-by-step setup with explicit registration:</p>
<pre class="highlight ruby"><code><span class="c1"># instead of ROM.setup:</span>
<span class="n">config</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Configuration</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/rom'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">config</span><span class="p">.</span><span class="nf">register_relation</span><span class="p">(</span><span class="no">Users</span><span class="p">)</span>

<span class="c1"># creates rom container with registered components</span>
<span class="n">container</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">container</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre>

<p>Here&rsquo;s an example of a setup that infers components from dir/file names:</p>
<pre class="highlight ruby"><code><span class="n">config</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Configuration</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/rom'</span><span class="p">)</span>

<span class="c1"># configure auto-registration by providing root path to your components</span>
<span class="c1"># namespacing is turned off</span>
<span class="n">config</span><span class="p">.</span><span class="nf">auto_registration</span><span class="p">(</span><span class="s2">"/path/to/components"</span><span class="p">,</span> <span class="ss">namespace: </span><span class="kp">false</span><span class="p">)</span>

<span class="c1"># assuming there's `/path/to/components/relations/users.rb`</span>
<span class="c1"># which defines `Users` relation class it will be automatically registered</span>

<span class="c1"># creates rom container with registered components</span>
<span class="n">container</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">container</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre>

<p>You can also use auto-registration with namespaces, which is turned on by default:</p>
<pre class="highlight ruby"><code><span class="n">config</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Configuration</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/rom'</span><span class="p">)</span>

<span class="c1"># configure auto-registration by providing root path to your components</span>
<span class="c1"># namespacing is turned on by default</span>
<span class="n">config</span><span class="p">.</span><span class="nf">auto_registration</span><span class="p">(</span><span class="s2">"/path/to/components"</span><span class="p">)</span>

<span class="c1"># assuming there's `/path/to/components/relations/users.rb`</span>
<span class="c1"># which defines `Relations::Users` class it will be automatically registered</span>

<span class="c1"># creates rom container with registered components</span>
<span class="n">container</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">container</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre>

<p>For a quick-start you can use an in-line style setup DSL:</p>
<pre class="highlight ruby"><code><span class="n">rom</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">container</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/rom'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="ss">:macros</span><span class="p">)</span> <span class="c1"># enable in-line component registration</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
      <span class="n">where</span><span class="p">(</span><span class="ss">id: </span><span class="nb">id</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="c1"># returns registered users relation object</span>
</code></pre>

<h2 id="command-api-improvements">Command API Improvements</h2>

<p>Probably the most noticable improvement/feature is the addition of the command graph DSL. The command graph was introduced in 0.9.0 and it allowed you to compose a single command that will be able to persist data coming in a nested structure, similar to <code>nested_attributes_for</code> in ActiveRecord, but more flexible.</p>

<p>This release introduces support for <code>update</code> and <code>delete</code> commands in the graph as well as a new DSL for graph definitions. Here&rsquo;s an example:</p>
<pre class="highlight ruby"><code><span class="c1"># assuming `rom` is your rom container and you have `create` commands</span>
<span class="c1"># for :users and :books relations</span>
<span class="n">command</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">command</span> <span class="c1"># returns command builder</span>

<span class="c1"># define a command that will persist user data with its book data</span>
<span class="n">create_command</span> <span class="o">=</span> <span class="n">command</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">user: :users</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
  <span class="n">user</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:books</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># call it with a nested input</span>
<span class="n">create_command</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
  <span class="ss">user: </span><span class="p">{</span>
    <span class="ss">name: </span><span class="s2">"Jane"</span><span class="p">,</span>
    <span class="ss">books: </span><span class="p">[{</span> <span class="ss">title: </span><span class="s2">"Book 1"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">title: </span><span class="s2">"Book 2"</span> <span class="p">}]</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre>

<p>It also supports <code>update</code> (<code>delete</code> works in the same way):</p>
<pre class="highlight ruby"><code><span class="c1"># assuming `rom` is your rom container and you have `update` commands</span>
<span class="c1"># for :users and :books relations</span>
<span class="n">command</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">command</span> <span class="c1"># returns command builder</span>

<span class="c1"># define a command that will restrict user by its id and update it</span>
<span class="n">user_update</span> <span class="o">=</span> <span class="n">command</span><span class="p">.</span><span class="nf">restrict</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">users</span><span class="p">,</span> <span class="n">user</span><span class="o">|</span> <span class="n">users</span><span class="p">.</span><span class="nf">by_id</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span> <span class="p">}</span>

<span class="n">update_command</span> <span class="o">=</span> <span class="n">command</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">user: </span><span class="n">user_update</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
  <span class="c1"># define an inner update command for books</span>
  <span class="n">books_update</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">restrict</span><span class="p">(</span><span class="ss">:books</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">books</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">book</span><span class="o">|</span>
    <span class="n">books</span><span class="p">.</span><span class="nf">by_user</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="nf">by_id</span><span class="p">(</span><span class="n">book</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="n">user</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">books: </span><span class="n">books_update</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># call it with a nested input</span>
<span class="n">update_command</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
  <span class="ss">user: </span><span class="p">{</span>
    <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span>
    <span class="ss">name: </span><span class="s2">"Jane Doe"</span><span class="p">,</span>
    <span class="ss">books: </span><span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Book 1"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Book 2"</span> <span class="p">}]</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre>

<p>As a bonus, you are free to use all types of commands in the same graph and have complete freedom in defining how specific relations must be restricted for a given command.</p>

<h3 id="new-command-result-api">New Command Result API</h3>

<p>Starting from 1.0.0 you can check whether a command result was successful or not:</p>
<pre class="highlight ruby"><code><span class="n">create_command</span> <span class="o">=</span> <span class="n">command</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">user: :users</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
  <span class="n">user</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:books</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">create_command</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
  <span class="ss">user: </span><span class="p">{</span>
    <span class="ss">name: </span><span class="s2">"Jane"</span><span class="p">,</span>
    <span class="ss">books: </span><span class="p">[{</span> <span class="ss">title: </span><span class="s2">"Book 1"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">title: </span><span class="s2">"Book 2"</span> <span class="p">}]</span>
  <span class="p">}</span>
<span class="p">)</span>

<span class="n">result</span><span class="p">.</span><span class="nf">success?</span> <span class="c1"># true if everything went fine, false otherwise</span>
<span class="n">result</span><span class="p">.</span><span class="nf">failure?</span> <span class="c1"># true if it failed, false otherwise</span>
</code></pre>

<h2 id="relation-api-extensions">Relation API Extensions</h2>

<p>Early version of rom-repository introduced a couple of plugins that now have become part of the core rom gem. They are opt-in and the adapter developers must decide whether or not it makes sense to enable them for adapter relations.</p>

<h3 id="view">View</h3>

<p>Relation <code>view</code> plugin is a DSL for defining relation views with an explicit header definition. It is typically useful for reusable relation projections that you can easily compose together in repositories.</p>

<p>Here&rsquo;s a simple example:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">view</span><span class="p">(</span><span class="ss">:listing</span><span class="p">,</span> <span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">])</span> <span class="k">do</span> <span class="o">|*</span><span class="n">order_args</span><span class="o">|</span>
    <span class="nb">select</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="o">*</span><span class="n">order_args</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">listing</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:id</span><span class="p">)</span>
</code></pre>

<p>This plugin plays major role in relation composition as it defines the header up-front, which allows repositories to generate mappers automatically, which is very convenient. It is also a nice way of specifying re-usable relation projections which some times may indicate where using an actual database view (assuming your db supports it) could simplify your queries.</p>

<h3 id="key-inference">Key Inference</h3>

<p>This simple plugin provides default value for a foreign-key in a relation. It is used for generating relation views used for composition in the repositories.</p>

<p>You can use it too:</p>
<pre class="highlight ruby"><code><span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">foreign_key</span> <span class="c1"># =&gt; `:user_id`</span>
</code></pre>

<h3 id="defining-default-datasets">Defining Default Datasets</h3>

<p>It is now possible to not only specify the name of a relation dataset, but also configure it using a block, when you do that your relation will be initialized with whatever that blocks returns, it is executed in the context of the dataset object:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">dataset</span><span class="p">(</span><span class="ss">:people</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">select</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:id</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<h3 id="mapper-extension">Mapper Extension</h3>

<p>There&rsquo;s one new feature in the mapper DSL where you can map values from multiple attributes into a new attribute:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">MyMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">attribute</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">from: </span><span class="p">[</span><span class="ss">:city</span><span class="p">,</span> <span class="ss">:street</span><span class="p">,</span> <span class="ss">:zipcode</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">city</span><span class="p">,</span> <span class="n">street</span><span class="p">,</span> <span class="n">zipcode</span><span class="o">|</span>
    <span class="s2">"</span><span class="si">#{</span><span class="n">city</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">street</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">zipcode</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<h2 id="release-plan">Release Plan</h2>

<p>Please try out the beta releases and provide feedback. Once we are sure that it works for everybody we&rsquo;ll be able to push the first RC and hopefully follow-up with the final 1.0.0 release shortly after the RC. Other gems that are now released as betas will be bumped to final versions and depend on rom 1.0.0 final.</p>

<p>The final release also means a major update of <a href="http://rom-rb.org">rom-rb.org</a> along with a new set of documentation, guides and tutorials. This is still a work in progress and needs help, please <a href="https://gitter.im/rom-rb/chat">get in touch</a> if you&rsquo;re interested in helping out.</p>

<p>Once rom 1.0.0 is out there will be major focus on rom-sql and rom-repository. There&rsquo;s a plan to <a href="https://github.com/rom-rb/rom-sql/issues/48">improve query DSL</a> in rom-sql and provide full CRUD interface for repositories that should be handy for simple applications.</p>

<p>If you see any issues, please report them in the individual issue trackers on Github or main <a href="https://github.com/rom-rb/rom/issues">rom</a> if you are not sure which gem it relates to.</p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2015/11/24/first-beta-of-rom-1-0-0-has-been-released#disqus_thread">Leave a comment</a></li></ul></div><hr /></div></article><article><header><h1><a href="/blog/2015/08/19/rom-0-9-0-released">ROM 0.9.0 Released</a></h1><div class="article-meta">Published on August 19, 2015 by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> under <a class="tag" href="/blog/tags/announcement/">announcement</a></div></header><hr /><div class="article-body"><p>We are pleased to announce the release of ROM 0.9.0! This is a big release which focuses on internal clean-up in the core library as a preparation for 1.0.0. For those of you hungry for new features - you won&rsquo;t be disappointed. As part of this release we are introducing new adapters, new gems extracted from rom and the long awaited high-level interface for ROM called rom-repository.</p>

<p>For notes about upgrading to ROM 0.9.0 please refer to <a href="https://github.com/rom-rb/rom/wiki/Upgrade-Guides">Upgrade Guides</a>.</p>

<p>Gem updates summary:</p>

<ul>
<li>rom 0.9.0 <a href="https://github.com/rom-rb/rom/blob/master/CHANGELOG.md#v090-2015-08-19">CHANGELOG</a></li>
<li>rom-sql 0.6.0 <a href="https://github.com/rom-rb/rom-sql/blob/master/CHANGELOG.md#v060-2015-08-19">CHANGELOG</a></li>
<li>rom-yaml 0.2.0 <a href="https://github.com/rom-rb/rom-yaml/blob/master/CHANGELOG.md#v020-2015-08-19">CHANGELOG</a></li>
<li>rom-csv 0.2.0 <a href="https://github.com/rom-rb/rom-csv/blob/master/CHANGELOG.md#v020-2015-08-19">CHANGELOG</a></li>
<li>rom-rails 0.5.0 <a href="https://github.com/rom-rb/rom-rails/blob/master/CHANGELOG.md#v050-2015-08-19">CHANGELOG</a></li>
<li>rom-lotus 0.2.0 <a href="https://github.com/rom-rb/rom-lotus/blob/master/CHANGELOG.md#v020-2015-08-19">CHANGELOG</a></li>
<li>rom-roda 0.2.0 <a href="https://github.com/rom-rb/rom-roda/blob/master/CHANGELOG.md#v020-2015-08-19">CHANGELOG</a></li>
</ul>

<p>New gems:</p>

<ul>
<li><a href="https://github.com/rom-rb/rom-repository">rom-repository</a> 0.1.0 - a higher-level interface with auto-mapping and additional relation plugins</li>
<li><a href="https://github.com/rom-rb/rom-mapper">rom-mapper</a> 0.1.1 - standalone mapper objects extracted from rom</li>
<li><a href="https://github.com/rom-rb/rom-model">rom-model</a> 0.1.1 - extracted from rom-rails, includes <code>Attributes</code> and <code>Validator</code> extensions</li>
<li><a href="https://github.com/rom-rb/rom-support">rom-support</a> 0.1.0 - a bunch of small extensions reused across all rom gems</li>
</ul>

<p>New adapters:</p>

<ul>
<li><a href="https://github.com/rom-rb/rom-couchdb">rom-couchdb</a> - an adapter for CouchDB</li>
<li><a href="http://github.com/rom-rb/rom-http">rom-http</a> - an abstract HTTP adapter useful for implementing concrete adapters for HTTP APIs</li>
<li><a href="http://github.com/rom-rb/rom-rethinkdb">rom-rethinkdb</a> - an adapter for RethinkDB</li>
</ul>

<h2 id="repository">Repository</h2>

<p>Probably the most significant addition coming with this release is rom-repository. Using lower-level APIs and configuring mappers manually is tedious in most of the cases that&rsquo;s why Repository was introduced.</p>

<p>Repository interface is very simple and built on top of Relation and Mapper API. It allows you to easily work with relations and have results automatically mapped to struct-like objects. There are a couple of neat plugins that ship with this gem which make relation composition ridiculously simple.</p>

<p>Repositories work <em>with all adapters</em> which means you can combine data from different data sources.</p>

<p>Here&rsquo;s an example repository class:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">UserRepository</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Repository</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">relations</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:tasks</span>

  <span class="k">def</span> <span class="nf">with_tasks</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">users</span><span class="p">.</span><span class="nf">by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">).</span><span class="nf">combine_children</span><span class="p">(</span><span class="ss">many: </span><span class="n">tasks</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">user_repo</span><span class="p">.</span><span class="nf">with_tasks</span><span class="p">.</span><span class="nf">to_a</span>
<span class="c1"># [#&lt;ROM::Struct[User] id=1 name="Jane" tasks=[#&lt;ROM::Struct[Task] id=2 user_id=1 title="Jane Task"&gt;]&gt;, #&lt;ROM::Struct[User] id=2 name="Joe" tasks=[#&lt;ROM::Struct[Task] id=1 user_id=2 title="Joe Task"&gt;]&gt;]</span>
</code></pre>

<p>Please refer to <a href="http://rom-rb.org/guides/basics/repositories/">Repository Guide</a> for the rationale and more information.</p>

<h2 id="multi-environment-support">Multi-Environment Support</h2>

<p>Initially, ROM supported its setup process through a global environment object. This was a good start that worked well with frameworks like Rails that expect globally accessible objects; however, we&rsquo;re pushing towards removing global state as much as possible.</p>

<p>For that reason in ROM 0.9.0 you can configure the environment as a standalone object, which comes with the benefit of being able to have more than one environment. Why would you want to have many environments? For example for database sharding, or separating components within your application where data comes from different sources and you want to keep them isolated.</p>

<p>Here&rsquo;s an example of a multi-environment setup:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Persistence</span><span class="o">::</span><span class="no">Command</span><span class="o">::</span><span class="no">CreateUser</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Commands</span><span class="o">::</span><span class="no">Create</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">relation</span> <span class="ss">:users</span>
  <span class="n">register_as</span> <span class="ss">:create</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Persistence</span><span class="o">::</span><span class="no">Query</span><span class="o">::</span><span class="no">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">dataset</span> <span class="ss">:users</span>
<span class="k">end</span>

<span class="n">command_env</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Environment</span><span class="p">.</span><span class="nf">new</span>

<span class="n">command_env</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="p">[</span><span class="ss">:postgres</span><span class="p">,</span> <span class="s1">'postgres://command_host/my_db'</span><span class="p">)</span>
<span class="n">command_env</span><span class="p">.</span><span class="nf">register_relation</span><span class="p">(</span><span class="no">Persistence</span><span class="o">::</span><span class="no">Command</span><span class="o">::</span><span class="no">CreateUser</span><span class="p">)</span>

<span class="n">command_container</span> <span class="o">=</span> <span class="n">command_env</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">command_container</span><span class="p">.</span><span class="nf">command</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="c1"># access to defined commands</span>

<span class="n">query_env</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Environment</span><span class="p">.</span><span class="nf">new</span>

<span class="n">query_env</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="p">[</span><span class="ss">:postgres</span><span class="p">,</span> <span class="s1">'postgres://query_host/my_db'</span><span class="p">)</span>
<span class="n">query_env</span><span class="p">.</span><span class="nf">register_relation</span><span class="p">(</span><span class="no">Persistence</span><span class="o">::</span><span class="no">Query</span><span class="o">::</span><span class="no">Users</span><span class="p">)</span>

<span class="n">query_container</span> <span class="o">=</span> <span class="n">query_env</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">query_container</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="c1"># access to defined relations</span>
</code></pre>

<p>Global setup process still works, but please refer to <a href="https://github.com/rom-rb/rom/wiki/Upgrade-Guides">upgrade guide</a> if you are using ROM standalone without any framework integration.</p>

<h2 id="gateway-configuration-support">Gateway Configuration Support</h2>

<p>A new interface for configuring individual adapter gateways has been added. For now the only customization you can make is configuring how relation inferrence should work:</p>
<pre class="highlight ruby"><code><span class="c1"># disable inferring relations from schema</span>
<span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="p">[</span>
  <span class="ss">:postgres</span><span class="p">,</span> <span class="s1">'postgres://localhost/db'</span><span class="p">,</span> <span class="ss">infer_relations: </span><span class="kp">false</span>
<span class="p">])</span>

<span class="c1"># cherry-pick which relations should be inferred</span>
<span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="p">[</span>
  <span class="ss">:postgres</span><span class="p">,</span> <span class="s1">'postgres://localhost/db'</span><span class="p">,</span> <span class="ss">inferrable_relations: </span><span class="p">[</span><span class="ss">:users</span><span class="p">,</span> <span class="ss">:tasks</span><span class="p">]</span>
<span class="p">])</span>

<span class="c1"># disallow inferrence for specific relations</span>
<span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="p">[</span>
  <span class="ss">:postgres</span><span class="p">,</span> <span class="s1">'postgres://localhost/db'</span><span class="p">,</span> <span class="ss">not_inferrable_relations: </span><span class="p">[</span><span class="ss">:some_table</span><span class="p">]</span>
<span class="p">])</span>
</code></pre>

<p>This feature is useful when you have a big database and you don&rsquo;t want to use ROM to deal with all of your relations.</p>

<h2 id="extracted-standalone-mappers">Extracted Standalone Mappers</h2>

<p>You can now install rom-mapper as a standalone gem and use the powerful mapping DSL:</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'rom-mapper'</span>

<span class="k">class</span> <span class="nc">PostMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">attribute</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">from: </span><span class="s1">'post_title'</span>

  <span class="n">wrap</span> <span class="ss">:author</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">from: </span><span class="s1">'post_author'</span>
    <span class="n">attribute</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">from: </span><span class="s1">'post_author_email'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">post_mapper</span> <span class="o">=</span> <span class="no">PostMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="n">post_mapper</span><span class="p">.</span><span class="nf">call</span><span class="p">([</span>
<span class="p">{</span> <span class="s1">'post_title'</span> <span class="o">=&gt;</span> <span class="s1">'Hello World'</span><span class="p">,</span> <span class="s1">'post_author'</span> <span class="o">=&gt;</span> <span class="s1">'Jane'</span><span class="p">,</span> <span class="s1">'post_author_email'</span> <span class="o">=&gt;</span> <span class="s1">'jane@doe.org'</span> <span class="p">}</span>
<span class="p">])</span>
<span class="c1"># [{:title=&gt;"Hello World", :author=&gt;{:name=&gt;"Jane", :email=&gt;"jane@doe.org"}}]</span>
</code></pre>

<p>Mappers are very powerful, make sure to check out the <a href="http://rom-rb.org/guides/basics/mappers/">Mapper Guides</a>.</p>

<h2 id="all-relations-are-lazy">All Relations Are Lazy</h2>

<p>Before 0.9.0, ROM had a separate layer for decorating your relations with a lazy-proxy wrapper. This has caused some confusion and unnecessary complexity, as the relations you defined were not the same thing that the <code>#relation()</code> method returned. It also turned out that implementing rom-repository was more difficult than it should have been.</p>

<p>That&rsquo;s why in ROM 0.9.0 all relations have lazy interface. It means that every relation method you define is auto-curried:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">by_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="n">where</span><span class="p">(</span><span class="ss">name: </span><span class="nb">name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># assuming your container is called `rom`</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span>

<span class="n">user_by_name</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="nf">by_name</span> <span class="c1"># returns auto-curried relation</span>

<span class="n">user_by_name</span><span class="p">[</span><span class="s1">'Jane'</span><span class="p">].</span><span class="nf">one!</span> <span class="c1"># call later on to apply the required argument</span>
</code></pre>

<h2 id="adapter-query-dsl-is-public">Adapter Query DSL is Public</h2>

<p>Starting from ROM 0.9.0, the query interface exposed by individual adapters is public, <strong>but</strong> it is not recommended to use it directly in your application. Relations should be used to encapsulate data access properly and query DSLs should not leak to the application layer.</p>
<pre class="highlight ruby"><code><span class="c1"># this is considered as a smell</span>
<span class="n">users</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Jane"</span><span class="p">)</span>

<span class="c1"># that's the proper way™</span>
<span class="n">users</span><span class="p">.</span><span class="nf">by_name</span><span class="p">(</span><span class="s2">"Jane"</span><span class="p">)</span>
</code></pre>

<h2 id="extracted-model-extensions">Extracted Model Extensions</h2>

<p>A couple of useful extensions have been extracted from the rom-rails gem into rom-model. These are standalone components that are based on Virtus and ActiveModel. We have an ambitious plan to rewrite it in the future on top of more powerful tools. Please refer to rom-model <a href="https://github.com/rom-rb/rom-model#rommodel">README</a> for more information.</p>

<p>Right now you can use <code>Attributes</code> and enhanced <code>Validator</code> objects with nice support for embedded validations:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">AuthorInput</span>
  <span class="kp">include</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Attributes</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">String</span>
  <span class="n">attribute</span> <span class="ss">:email</span><span class="p">,</span> <span class="no">String</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">PostInput</span>
  <span class="kp">include</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Attributes</span>

  <span class="n">attribute</span> <span class="ss">:title</span><span class="p">,</span> <span class="no">String</span>
  <span class="n">attribute</span> <span class="ss">:author</span><span class="p">,</span> <span class="no">AuthorInput</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">PostValidator</span>
  <span class="kp">include</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Validator</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>

  <span class="n">embedded</span> <span class="ss">:author</span> <span class="k">do</span>
    <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">input</span> <span class="o">=</span> <span class="no">PostInput</span><span class="p">[{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">author: </span><span class="p">{</span> <span class="ss">name: </span><span class="s1">'Jane'</span><span class="p">,</span> <span class="ss">email: </span><span class="s1">'jane@doe.org'</span> <span class="p">}</span> <span class="p">}]</span>

<span class="n">validator</span> <span class="o">=</span> <span class="no">PostValidator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="n">validator</span><span class="p">.</span><span class="nf">valid?</span>
</code></pre>

<h2 id="http-adapter">HTTP Adapter</h2>

<p>The new, abstract <code>rom-http</code> adapter is a fantastic addition to the growing list of ROM adapters. It gives you a solid foundation for building a custom adapter which needs to talk via HTTP protocol. It&rsquo;s pretty flexible, and works like any other rom adapter - which means that you can use either the lower-level relation and mapping APIs or set it up with <code>rom-repository</code> and auto-mapping.</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'http'</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:http</span><span class="p">]</span>
  <span class="n">dataset</span> <span class="ss">:users</span>

  <span class="k">def</span> <span class="nf">by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">with_path</span><span class="p">(</span><span class="nb">id</span><span class="p">.</span><span class="nf">to_s</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">rom</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Environment</span><span class="p">.</span><span class="nf">new</span>

<span class="n">rom</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:http</span><span class="p">,</span> <span class="p">{</span>
  <span class="ss">uri: </span><span class="s1">'http://jsonplaceholder.typicode.com'</span><span class="p">,</span>
  <span class="ss">request_handler: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="p">{</span>
    <span class="no">HTTP</span><span class="p">.</span><span class="nf">headers</span><span class="p">(</span><span class="n">dataset</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">public_send</span><span class="p">(</span>
      <span class="n">dataset</span><span class="p">.</span><span class="nf">request_method</span><span class="p">,</span>
      <span class="s2">"</span><span class="si">#{</span><span class="n">dataset</span><span class="p">.</span><span class="nf">uri</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">dataset</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">dataset</span><span class="p">.</span><span class="nf">path</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
      <span class="ss">params: </span><span class="n">dataset</span><span class="p">.</span><span class="nf">params</span>
    <span class="p">)</span>
  <span class="p">},</span>
  <span class="ss">response_handler: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span> <span class="p">{</span>
    <span class="no">Array</span><span class="p">([</span><span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">)]).</span><span class="nf">flatten</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="n">rom</span><span class="p">.</span><span class="nf">register_relation</span><span class="p">(</span><span class="no">Users</span><span class="p">)</span>

<span class="n">container</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">container</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">by_id</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">to_a</span>
<span class="c1"># =&gt; GET http://jsonplaceholder.typicode.com/users/1 [ Accept: application/json ]</span>
</code></pre>

<h2 id="support-campaign">Support Campaign</h2>

<p>As announced <a href="https://github.com/rom-rb/rom-model#rommodel">a couple of weeks ago</a>, we&rsquo;re running a campaign for <a href="http://salt.bountysource.com/teams/rom-rb">sustainable development</a>. We already have people who&rsquo;ve decided to donate - thank you <strong>so much</strong> for your support.</p>

<p>With ROM 0.9.0 we&rsquo;re close to the first stable 1.0.0 release, but there&rsquo;s still a lot to be done. Please consider supporting this great effort.</p>

<p>Please also remember that ROM is a project open for contributions and currently we have 24 repositories under our GitHub organization. There are many adapters looking for maintainers, there are many smaller tasks to do in core libraries, framework integrations and other extensions. Please get in touch if you&rsquo;re interested in contributing &lt;3.</p>

<h2 id="reporting-issues-and-support">Reporting Issues and Support</h2>

<p>All repositories now have their own issue trackers enabled on GitHub. If you find a bug, or have problems using ROM, please report an issue for a specific project. If you&rsquo;re not sure which project it relates to, just report it in the main <a href="https://github.com/rom-rb/rom/issues">rom issue tracker</a>, and we&rsquo;ll move it to the right place if needed.</p>

<p>For any random questions and support requests you can talk to us on <a href="http://gitter.im/rom-rb/chat">gitter</a>.</p>

<p><s>Last but not least - we&rsquo;re looking for help in setting up a Discourse instance on DigitalOcean to make it simpler for people to discuss things as an alternative to gitter.</s></p>

<p>We&rsquo;ve got <a href="http://discuss.rom-rb.org">a discourse</a> instance up and running :)</p>

<h2 id="rom-1-0-0-see-you-at-rossconf">ROM 1.0.0 - See You at ROSSConf!</h2>

<p>In case you missed it, ROM is part of the second edition of <a href="http://www.rossconf.io/event/berlin/">ROSSConf in Berlin</a>, where you&rsquo;ll have a chance to contribute to the project. We have a crazy plan to release 1.0.0 during the event or at least close all the remaining issues and get an RC out of the door. :)</p>

<p>We&rsquo;ll be working on the list of issues scheduled for 1.0.0, thus it is important to get as much feedback as possible from <strong>you</strong>.</p>

<p>Please try out ROM 0.9.0. Let us know your thoughts. Report issues, ideas, comments, anything that can help in specifying what should be done for 1.0.0 will be grately appreciated.</p>

<p>Thanks! &lt;3</p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2015/08/19/rom-0-9-0-released#disqus_thread">Leave a comment</a></li></ul></div><hr /></div></article><article><header><h1><a href="/blog/2015/08/04/sustainable-development-campaign">Sustainable Development Campaign</a></h1><div class="article-meta">Published on August 04, 2015 by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> under <a class="tag" href="/blog/tags/oss/">oss</a> <a class="tag" href="/blog/tags/support/">support</a></div></header><hr /><div class="article-body"><p>ROM has been in development for a couple of years already, in fact, its <a href="https://github.com/solnic/rom-relation/tree/pre-mapper-extraction">early prototype</a> was built in 2012, and has gone through multiple phases before the final architecture was introduced in October last year. This has been a huge effort which resulted in the creation of many smaller libraries and, of course, ROM itself.</p>

<p>One of the main reasons that this project was started was to discover a better way of writing Ruby code that would result in a cleaner architecture for the systems we&rsquo;re building. The Ruby ecosystem has mostly been shaped by the Active Record pattern introduced in the Rails framework, but ROM tries to move away from the common approach, so that it&rsquo;s easier to build <strong>and grow</strong> systems built in Ruby.</p>

<p>It&rsquo;s been an interesting journey with lots of experimentation, and we are getting there, as ROM is approaching 1.0.0.</p>

<p>There are a few mind-shifting aspects of ROM which are worth consideration as general programming guidelines in Ruby:</p>

<ul>
<li>Prefer simple objects that don&rsquo;t change (mutate) and have a single purpose to exist</li>
<li>Prefer interfaces that have no side-effects</li>
<li>Embrace simple data structures rather than complicated objects that mix data and behavior</li>
<li>Prefer objects over classes, and always treat dependencies explicitly</li>
<li>Pay attention to boundaries and proper separation of concerns</li>
</ul>

<p>Those guideliness have led to the decision that ROM will not be a typical Object Relational Mapper which tries to hide your database behind walls of complicated and leaky abstractions and pretend that &ldquo;you can just use objects&rdquo;. This is the reason why ROM gives you a powerful interface to use your database effectively; which can be levaraged to design your systems with simpler data structures in mind and decouple your application layer from persistence concerns.</p>

<p>Such an approach has a significant impact on <strong>lowering complexity</strong> of your application layer.</p>

<h2 id="growing-the-ecosystem">Growing The Ecosystem</h2>

<p>ROM is already a big project; if you consider its lower level libraries, over 14 adapters and integration with 3 frameworks. But it goes beyond that - other libraries are being developed that are based the on same programming principles. It is absolutely amazing to see that happening. The ecosystem is growing.</p>

<p>We have reached a point where ROM needs a sustainable pace of development, so that following things can happen:</p>

<ul>
<li>Reach 1.0.0 in September</li>
<li>Extract re-usable APIs into separate libraries so that other projects can benefit from them</li>
<li>Improve existing adapters to be production-ready (the more the merrier)</li>
<li>Address all known issues in a timely fashion</li>
<li>Support users in multiple channels</li>
<li>Establish a solid release process with a CI setup that can help in developing adapters and extensions</li>
</ul>

<p>In order to be able to do all of that we need your support.</p>

<h2 id="campaign-on-bountysource">Campaign on Bountysource</h2>

<p>Bountysource is a service that helps in raising funds for Open Source projects. Its latest feature, called Salt, allows sustainable fundraising on a monthly basis. This makes it possible to support a steady pace of development - which is crucial for a complex project like ROM.</p>

<p>If you&rsquo;d like to see ROM grow faster, please consider supporting the project through <a href="https://salt.bountysource.com/teams/rom-rb">the campaign</a>.</p>

<p>We want to take the project to the next level with this campaign and hope to expand the team so that more people can work continuously on ROM. We are happy to use the funds to sponsor work on ROM itself and also on any other library that the project could benefit from.</p>

<h2 id="what-39-s-in-it-for-you">What&rsquo;s in it for you?</h2>

<p>There are many ways in which you and your company can benefit from ROM <em>today</em>, but there&rsquo;s still a lot to be done to make ROM simpler to use for the common application use-case. This includes adding convenient, high-level abstractions as well as providing great documentation and other resources that would teach people how to use ROM.</p>

<p>If you&rsquo;re interested in the project but it still feels &ldquo;weird&rdquo; or &ldquo;too complicated&rdquo;, this is exactly the reason that the campaign was started. ROM <em>should be accessible for everybody</em>, including less experienced developers. Not only do we want to promote ROM, but also, the general approach to writing Ruby code, which we believe results in a better and more maintainable code-base.</p>

<p>For any questions or concerns, please do not hesitate to <a href="https://twitter.com/_solnic_">get in touch</a>.</p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2015/08/04/sustainable-development-campaign#disqus_thread">Leave a comment</a></li></ul></div><hr /></div></article><article><header><h1><a href="/blog/2015/06/22/rom-0-8-0-released">ROM 0.8.0 Released</a></h1><div class="article-meta">Published on June 22, 2015 by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> under <a class="tag" href="/blog/tags/release/">release</a> <a class="tag" href="/blog/tags/announcement/">announcement</a></div></header><hr /><div class="article-body"><p>We&rsquo;re very happy to announce the release of Ruby Object Mapper 0.8.0. This release ships with the support for nested input for commands and many improvements in mappers. You can look at <a href="https://github.com/rom-rb/rom/blob/master/CHANGELOG.md#v070-2015-06-22">the changelog</a> for the full overview.</p>

<p>Apart from ROM 0.8.0 release there are also updates of the following gems:</p>

<ul>
<li>rom-sql 0.5.2 which comes with improved migration tasks that no longer require env finalization <a href="https://github.com/rom-rb/rom-sql/blob/master/CHANGELOG.md#v070-2015-06-22">CHANGELOG</a></li>
<li>rom-rails 0.4.0 with the support for embedded validators <a href="https://github.com/rom-rb/rom-rails/blob/master/CHANGELOG.md#v070-2015-06-22">CHANGELOG</a></li>
</ul>

<p>There are 2 new adapters added to the rom-rb organization so check them out:</p>

<ul>
<li><a href="https://github.com/rom-rb/rom-couchdb">rom-couchdb</a></li>
<li><a href="https://github.com/rom-rb/rom-git">rom-git</a></li>
</ul>

<h2 id="support-for-nested-input">Support For Nested Input</h2>

<p>ROM commands are now even more powerful by allowing composition of multiple commands into one that can receive a nested input which will be used to insert data into multiple relations. This feature is compatible with combined relation mapping which means you can pipe results from a combined command through mappers just like in case of combined relations.</p>

<p>When do you want to use this feature? Every time you want to persist entire object graph, in example a post with its tags or a user with an address.</p>

<p>Here&rsquo;s a complete example of using combined commands with a mapper:</p>
<pre class="highlight ruby"><code><span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/rom'</span><span class="p">)</span>

<span class="no">ROM</span><span class="o">::</span><span class="no">SQL</span><span class="p">.</span><span class="nf">gateway</span><span class="p">.</span><span class="nf">connection</span><span class="p">.</span><span class="nf">create_table</span> <span class="ss">:posts</span> <span class="k">do</span>
  <span class="n">primary_key</span> <span class="ss">:id</span>
  <span class="n">column</span> <span class="ss">:title</span><span class="p">,</span> <span class="no">String</span>
<span class="k">end</span>

<span class="no">ROM</span><span class="o">::</span><span class="no">SQL</span><span class="p">.</span><span class="nf">gateway</span><span class="p">.</span><span class="nf">connection</span><span class="p">.</span><span class="nf">create_table</span> <span class="ss">:tags</span> <span class="k">do</span>
  <span class="n">primary_key</span> <span class="ss">:id</span>
  <span class="n">foreign_key</span> <span class="ss">:post_id</span><span class="p">,</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="n">column</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">String</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Posts</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Tags</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">CreatePost</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Commands</span><span class="o">::</span><span class="no">Create</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">relation</span> <span class="ss">:posts</span>
  <span class="n">result</span> <span class="ss">:one</span>
  <span class="n">register_as</span> <span class="ss">:create</span>
  <span class="n">input</span> <span class="no">Transproc</span><span class="p">(</span><span class="ss">:accept_keys</span><span class="p">,</span> <span class="p">[</span><span class="ss">:title</span><span class="p">])</span> <span class="c1"># filters out `:tags` key</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">CreateTag</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Commands</span><span class="o">::</span><span class="no">Create</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">relation</span> <span class="ss">:tags</span>
  <span class="n">register_as</span> <span class="ss">:create</span>
  <span class="n">input</span> <span class="no">Transproc</span><span class="p">(</span><span class="ss">:accept_keys</span><span class="p">,</span> <span class="p">[</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:post_id</span><span class="p">])</span>
  <span class="n">associates</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">key: </span><span class="p">[</span><span class="ss">:post_id</span><span class="p">,</span> <span class="ss">:id</span><span class="p">]</span> <span class="c1"># automatically sets FK value</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">PostMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">relation</span> <span class="ss">:posts</span>
  <span class="n">register_as</span> <span class="ss">:entity</span>

  <span class="n">combine</span> <span class="ss">:tags</span><span class="p">,</span> <span class="ss">on: </span><span class="p">{</span> <span class="ss">id: :post_id</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">rom</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">create_post_with_tags</span> <span class="o">=</span> <span class="n">rom</span>
  <span class="p">.</span><span class="nf">command</span><span class="p">([{</span> <span class="ss">post: :posts</span> <span class="p">},</span> <span class="p">[</span><span class="ss">:create</span><span class="p">,</span> <span class="p">[</span><span class="ss">:tags</span><span class="p">,</span> <span class="p">[</span><span class="ss">:create</span><span class="p">]]]])</span>
  <span class="p">.</span><span class="nf">as</span><span class="p">(</span><span class="ss">:entity</span><span class="p">)</span>

<span class="n">create_post_with_tags</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
  <span class="ss">post: </span><span class="p">{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">tags: </span><span class="p">[{</span> <span class="ss">name: </span><span class="s1">'red'</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s1">'green'</span> <span class="p">}]</span> <span class="p">}</span>
<span class="p">).</span><span class="nf">to_a</span>
<span class="c1"># [</span>
<span class="c1">#   {</span>
<span class="c1">#     :id =&gt; 1,</span>
<span class="c1">#     :title =&gt; "Hello World",</span>
<span class="c1">#     :tags =&gt; [</span>
<span class="c1">#       { :id=&gt;1, :post_id=&gt;1, :name=&gt;"red" },</span>
<span class="c1">#       { :id=&gt;2, :post_id=&gt;1, :name=&gt;"green" }</span>
<span class="c1">#      ]</span>
<span class="c1">#   }</span>
<span class="c1"># ]</span>
</code></pre>

<h2 id="mapper-steps">Mapper Steps</h2>

<p>Transforming data with mappers can be really complex and sometimes you may want to define multiple mapping steps. That&rsquo;s why we introduced a new interface in Mapper DSL where you can do just that:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">UserMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">step</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">from: :user_id</span>
    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">from: :user_name</span>
  <span class="k">end</span>

  <span class="n">step</span> <span class="k">do</span>
    <span class="n">wrap</span> <span class="ss">:details</span> <span class="k">do</span>
      <span class="n">attribute</span> <span class="ss">:name</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="no">UserMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="n">mapper</span><span class="p">.</span><span class="nf">call</span><span class="p">([{</span> <span class="ss">user_id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">user_name: </span><span class="s1">'Jane'</span> <span class="p">}])</span>
<span class="c1"># [{ :id =&gt; 1, :details =&gt; { :name =&gt; "Jane" } }]</span>
</code></pre>

<p>Typically you want to use this feature when mapping logic is too complex to be expressed using nested blocks. It&rsquo;s especially useful when dealing with multiple group/ungroup/wrap/unwrap/fold/unfold operations that simply cannot be defined as a deeply nested mapping definition block.</p>

<h2 id="new-mapping-transformations">New Mapping Transformations</h2>

<p>We have 3 new transformations <code>fold</code>, <code>unfold</code> and <code>ungroup</code> which makes mappers even more powerful.</p>

<p>Folding can be used to collapse values from multiple tuples under a single array attribute:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">PostFoldMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">fold</span> <span class="ss">tag_list: </span><span class="p">[</span><span class="ss">:tag_name</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="no">PostFoldMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="nb">puts</span> <span class="n">mapper</span><span class="p">.</span><span class="nf">call</span><span class="p">([</span>
  <span class="p">{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">tag_name: </span><span class="s1">'red'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">tag_name: </span><span class="s1">'green'</span> <span class="p">}</span>
<span class="p">]).</span><span class="nf">inspect</span>
<span class="c1"># [{:title=&gt;"Hello World", :tag_list=&gt;["red", "green"]}]</span>
</code></pre>

<p>Unfolding is, unsurprisingly, an inversion of folding:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">PostUnfoldMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">unfold</span> <span class="ss">:tag_name</span><span class="p">,</span> <span class="ss">from: :tag_list</span>
<span class="k">end</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="no">PostUnfoldMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="nb">puts</span> <span class="n">mapper</span><span class="p">.</span><span class="nf">call</span><span class="p">([{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">tag_list: </span><span class="p">[</span><span class="s1">'red'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">]</span> <span class="p">}]).</span><span class="nf">inspect</span>
<span class="c1"># [{:tag_name=&gt;"red", :title=&gt;"Hello World"}, {:tag_name=&gt;"green", :title=&gt;"Hello World"}]</span>
</code></pre>

<p>Now you can also ungroup tuples:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">PostUngroupMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">ungroup</span> <span class="ss">:tags</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:tag_name</span><span class="p">,</span> <span class="ss">from: :name</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="no">PostUngroupMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="nb">puts</span> <span class="n">mapper</span><span class="p">.</span><span class="nf">call</span><span class="p">([</span>
  <span class="p">{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">tags: </span><span class="p">[{</span> <span class="ss">name: </span><span class="s1">'red'</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s1">'green'</span> <span class="p">}]</span> <span class="p">}</span>
<span class="p">]).</span><span class="nf">inspect</span>
<span class="c1"># [{:tag_name=&gt;"red", :title=&gt;"Hello World"}, {:tag_name=&gt;"green", :title=&gt;"Hello World"}]</span>
</code></pre>

<h2 id="guides">Guides</h2>

<p>ROM is growing really fast and there&rsquo;s a lot of functionality that is difficult to describe in API documentation. That&rsquo;s why we started a new <a href="http://rom-rb.org/guides">Guides</a> section on the official rom-rb.org website.</p>

<p>You can already find a lot of information about ROM setup, adapters, relations, commands and mappers. We&rsquo;ll be adding more content and improving existing documentation based on the feedback so please check them out and let us know what you think.</p>

<p>In the upcoming weeks you should also see new tutorials covering topics like building your own persistence layer with ROM, handling data import with ROM or how to use ROM with various JSON serializers like Roar or Yaks, so stay tuned!</p>

<h2 id="next-release">Next Release</h2>

<p>We have a pretty good understanding of what we want to achieve with the next 0.9.0 release which will improve the internal architecture of ROM. We&rsquo;re planning to split <code>rom</code> gem into <a href="https://github.com/rom-rb/rom/issues/256">smaller pieces</a> and introduce cleaner and more explicit interfaces for setting up ROM.</p>

<p>Another planned change is introducing <a href="https://github.com/rom-rb/rom/issues/193">Policy Over Configuration</a> API which should improve ROM configuration and handling various conventions.</p>

<p>This release will be a big step towards 1.0.0 which is scheduled for September (yes, this year ;)).</p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2015/06/22/rom-0-8-0-released#disqus_thread">Leave a comment</a></li></ul></div><hr /></div></article><article><header><h1><a href="/blog/2015/05/18/rom-0-7-0-released">ROM 0.7.0 Released</a></h1><div class="article-meta">Published on May 18, 2015 by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> under <a class="tag" href="/blog/tags/release/">release</a> <a class="tag" href="/blog/tags/announcement/">announcement</a></div></header><hr /><div class="article-body"><p>Ruby Object Mapper has reached another milestone and today we&rsquo;re happy to announce
the release of ROM 0.7.0! This version solidifies core functionality of ROM and
adds new, great features on top of existing APIs.</p>

<p>This release includes updates of the following gems:</p>

<ul>
<li>rom 0.7.0 <a href="https://github.com/rom-rb/rom/blob/master/CHANGELOG.md#v070-2015-05-17">CHANGELOG</a></li>
<li>rom-sql 0.4.3 <a href="https://github.com/rom-rb/rom-sql/blob/master/CHANGELOG.md#v042-2015-05-17">CHANGELOG</a></li>
<li>rom-rails 0.3.2 <a href="https://github.com/rom-rb/rom-rails/blob/master/CHANGELOG.md#v032-2015-05-17">CHANGELOG</a></li>
</ul>

<p>We&rsquo;re also excited to see development of new adapters:</p>

<ul>
<li><a href="https://github.com/rom-rb/rom-rethinkdb">rom-rethinkdb</a></li>
<li><a href="https://github.com/rom-rb/rom-neo4j">rom-neo4j</a></li>
<li><a href="https://github.com/rom-rb/rom-event_store">rom-event_store</a></li>
<li><a href="https://github.com/rom-rb/rom-influxdb">rom-influxdb</a></li>
</ul>

<p>Let&rsquo;s see what this new release brings.</p>

<h2 id="explicit-eager-loading">Explicit eager-loading</h2>

<p>Probably the most important addition in this release is the ability to eager-load entire object graph using the new <code>combine</code> interface. Previously the only way to load a nested data-structure into memory was to use a join. Starting from 0.7.0 you can combine relations together and map the resulting graph into an aggregate with ease. As a bonus side-effect it allows to &ldquo;join&rdquo; relations coming from different datastores in memory. This feature leverages data-pipeline feature of ROM that was introduced in 0.6.0.</p>

<p>Let&rsquo;s see how this works:</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'rom'</span>

<span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span> <span class="ss">:sql</span><span class="p">,</span> <span class="s1">'sqlite::memory'</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">by_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="n">where</span><span class="p">(</span><span class="ss">name: </span><span class="nb">name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Tasks</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">for_users</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="n">where</span><span class="p">(</span><span class="ss">user_id: </span><span class="n">users</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="n">user</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span> <span class="p">})</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">rom</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">repositories</span><span class="p">[</span><span class="ss">:default</span><span class="p">].</span><span class="nf">connection</span>

<span class="n">db</span><span class="p">.</span><span class="nf">create_table</span> <span class="ss">:users</span> <span class="k">do</span>
  <span class="n">primary_key</span> <span class="ss">:id</span>
  <span class="no">String</span> <span class="ss">:name</span>
<span class="k">end</span>

<span class="n">db</span><span class="p">.</span><span class="nf">create_table</span> <span class="ss">:tasks</span> <span class="k">do</span>
  <span class="n">primary_key</span> <span class="ss">:id</span>
  <span class="no">Integer</span> <span class="ss">:user_id</span>
  <span class="no">String</span> <span class="ss">:title</span>
<span class="k">end</span>

<span class="n">db</span><span class="p">[</span><span class="ss">:users</span><span class="p">].</span><span class="nf">insert</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s1">'Jane'</span>
<span class="n">db</span><span class="p">[</span><span class="ss">:users</span><span class="p">].</span><span class="nf">insert</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">name: </span><span class="s1">'John'</span>

<span class="n">db</span><span class="p">[</span><span class="ss">:tasks</span><span class="p">].</span><span class="nf">insert</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">user_id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">title: </span><span class="s1">'Task for John'</span>
<span class="n">db</span><span class="p">[</span><span class="ss">:tasks</span><span class="p">].</span><span class="nf">insert</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">user_id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s1">'Task for Jane'</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span>
<span class="n">tasks</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:tasks</span><span class="p">)</span>

<span class="n">user_with_tasks</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="nf">by_name</span><span class="p">(</span><span class="s1">'Jane'</span><span class="p">).</span><span class="nf">combine</span><span class="p">(</span><span class="n">tasks</span><span class="p">.</span><span class="nf">for_users</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">user_with_tasks</span><span class="p">.</span><span class="nf">to_a</span><span class="p">.</span><span class="nf">inspect</span>

<span class="c1"># [</span>
<span class="c1">#   #&lt;ROM::Relation::Loaded:0x007fde8220e708</span>
<span class="c1">#     @source=#&lt;Users dataset=#&lt;Sequel::SQLite::Dataset: "SELECT * FROM `users` WHERE (`name` = 'Jane')"&gt;&gt;,</span>
<span class="c1">#     @collection=[{:id=&gt;1, :name=&gt;"Jane"}]&gt;,</span>
<span class="c1">#     [</span>
<span class="c1">#       #&lt;ROM::Relation::Loaded:0x007fde82207c00</span>
<span class="c1">#         @source=#&lt;Tasks dataset=#&lt;Sequel::SQLite::Dataset: "SELECT * FROM `tasks` WHERE (`user_id` IN (1))"&gt;&gt;,</span>
<span class="c1">#         @collection=[{:id=&gt;2, :user_id=&gt;1, :title=&gt;"Task for Jane"}]&gt;</span>
<span class="c1">#     ]</span>
<span class="c1"># ]</span>
</code></pre>

<p>As you can see ROM executes the minimum amount of needed SQL queries. It shouldn&rsquo;t surprise given that you explicitly told ROM which relations should be used to load the data. As you can probably imagine you are free to use whatever strategy fits better in a particular use case. You can use combine, or you can use joins, or both at the same time. It doesn&rsquo;t really matter since it&rsquo;s just data flowing from one object to another producing end result - a nested data structure.</p>

<h2 id="mapping-combined-relations">Mapping combined relations</h2>

<p>To map result from our previous example we can create a mapper using the mapping DSL named the same as in relations - <code>combine</code>:</p>
<pre class="highlight ruby"><code><span class="no">Entity</span> <span class="o">=</span> <span class="no">Virtus</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span><span class="ss">coerce: </span><span class="kp">false</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Task</span>
  <span class="kp">include</span> <span class="no">Entity</span>

  <span class="n">attribute</span> <span class="ss">:id</span>
  <span class="n">attribute</span> <span class="ss">:title</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Entity</span>

  <span class="n">attribute</span> <span class="ss">:id</span>
  <span class="n">attribute</span> <span class="ss">:name</span>

  <span class="n">attribute</span> <span class="ss">:tasks</span><span class="p">,</span> <span class="no">Array</span><span class="p">[</span><span class="no">Task</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">UserMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">relation</span> <span class="ss">:users</span>
  <span class="n">register_as</span> <span class="ss">:entity</span>

  <span class="n">model</span> <span class="no">User</span>

  <span class="n">combine</span> <span class="ss">:tasks</span><span class="p">,</span> <span class="ss">on: </span><span class="p">{</span> <span class="ss">id: :user_id</span> <span class="p">}</span> <span class="k">do</span>
    <span class="n">model</span> <span class="no">Task</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">user_with_tasks</span><span class="p">.</span><span class="nf">as</span><span class="p">(</span><span class="ss">:entity</span><span class="p">).</span><span class="nf">to_a</span><span class="p">.</span><span class="nf">inspect</span>
<span class="c1"># [</span>
<span class="c1">#   #&lt;User:0x007fc86a820250 @id=1, @name="Jane",</span>
<span class="c1">#       @tasks=[#&lt;Task:0x007fc86a8221b8 @id=2, @title="Task for Jane"&gt;]&gt;</span>
<span class="c1"># ]</span>
</code></pre>

<h2 id="more-mapping-goodies">More mapping goodies</h2>

<p>Mapper DSL was extended with a couple of nifty features, let&rsquo;s quickly go through them:</p>

<p>Ability to reuse existing mappers:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">TaskMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">model</span> <span class="no">Task</span>

  <span class="n">attribute</span> <span class="ss">:title</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">UserMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">model</span> <span class="no">User</span>

  <span class="n">group</span> <span class="ss">:tasks</span><span class="p">,</span> <span class="ss">mapper: </span><span class="no">TaskMapper</span>
<span class="k">end</span>
</code></pre>

<p>Ability to reject any unspecified keys:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">UserMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">reject_keys</span> <span class="kp">true</span>

  <span class="n">attribute</span> <span class="ss">:id</span>
  <span class="n">attribute</span> <span class="ss">:name</span>
<span class="k">end</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="no">UserMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="n">mapper</span><span class="p">.</span><span class="nf">call</span> <span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s1">'Jane'</span><span class="p">,</span> <span class="ss">email: </span><span class="s1">'jane@doe.org'</span> <span class="p">}]</span>
<span class="c1"># [{ :id =&gt; 1, :name =&gt; "Jane" }]</span>
</code></pre>

<p>Ability to <code>unwrap</code> a nested hash:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">UserMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">unwrap</span> <span class="ss">address: </span><span class="p">[</span><span class="ss">:street</span><span class="p">,</span> <span class="ss">:city</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="no">UserMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="n">mapper</span><span class="p">.</span><span class="nf">call</span> <span class="p">[{</span> <span class="ss">name: </span><span class="s1">'Jane'</span><span class="p">,</span> <span class="ss">address: </span><span class="p">{</span> <span class="ss">street: </span><span class="s1">'Street 1'</span><span class="p">,</span> <span class="ss">city: </span><span class="s1">'NYC'</span> <span class="p">}</span> <span class="p">}]</span>
<span class="c1"># [{ :name =&gt; "Jane", :street =&gt; "Street 1", :city =&gt; "NYC" }]</span>
</code></pre>

<h3 id="registering-custom-objects-as-mappers">Registering Custom Objects as Mappers</h3>

<p>Powerful ROM mapping DSL still not covering your specific needs? No worries, now you can register anything that responds to <code>#call(data)</code> as your mapper:</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'rom'</span>

<span class="n">my_mapper</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="n">data</span> <span class="p">{</span>
  <span class="c1"># for the sake of example...</span>
  <span class="n">data</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">tuple</span><span class="o">|</span> <span class="n">tuple</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span> <span class="p">}</span>
<span class="p">}</span>

<span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span> <span class="ss">:memory</span>

<span class="no">ROM</span><span class="p">.</span><span class="nf">mappers</span> <span class="k">do</span>
  <span class="n">register</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">name_list: </span><span class="n">my_mapper</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:memory</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">rom</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">rom</span><span class="p">.</span><span class="nf">repositories</span><span class="p">[</span><span class="ss">:default</span><span class="p">].</span><span class="nf">dataset</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">insert</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s1">'Jane'</span>
<span class="n">rom</span><span class="p">.</span><span class="nf">repositories</span><span class="p">[</span><span class="ss">:default</span><span class="p">].</span><span class="nf">dataset</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">insert</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">name: </span><span class="s1">'John'</span>

<span class="nb">puts</span> <span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">as</span><span class="p">(</span><span class="ss">:name_list</span><span class="p">).</span><span class="nf">to_a</span><span class="p">.</span><span class="nf">inspect</span>
<span class="c1"># ["Jane", "John"]</span>
</code></pre>

<h3 id="plugin-interface">Plugin Interface</h3>

<p>Last but not least - ROM now has a basic plugin interface. We already ported a couple of features to plugin infrastructure. You can start experimenting with it already:</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'rom'</span>

<span class="k">module</span> <span class="nn">MyLoggerPlugin</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="c1"># do stuff</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">ROM</span><span class="p">.</span><span class="nf">plugins</span> <span class="k">do</span>
  <span class="n">register</span> <span class="ss">:logger</span><span class="p">,</span> <span class="no">MyPublisherPlugin</span><span class="p">,</span> <span class="ss">type: :command</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">CreateStuffCommand</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Commands</span><span class="o">::</span><span class="no">Create</span><span class="p">[</span><span class="ss">:memory</span><span class="p">]</span>
  <span class="n">use</span> <span class="ss">:logger</span>
<span class="k">end</span>
</code></pre>

<p>Plugins can be provided only for a specific adapter and are grouped by relation, command and mapper types.</p>

<h3 id="roadmap-towards-1-0-0">Roadmap: Towards 1.0.0</h3>

<p>ROM is already a powerful toolkit for data mapping and a uniform interface to various different data sources.</p>

<p>In the immediate future, version 0.8.0 will bring major improvements to the Command API and—as always—a bunch of smaller bug fixes and enhancements.</p>

<p>We’ve started using <a href="http://waffle.io/">Waffle</a> to help define the <a href="http://waffle.io/rom-rb/rom">scope of work</a> for  upcoming minor versions and the goals for the final 1.0.0 release. All issues that need to be completed prior to the final 1.0.0 release are labelled as &ldquo;1.0.0&rdquo; and will be done in one of the minor releases before the final 1.0.0 RC is announced.</p>

<p>As we work towards the 1.0.0 release, we&rsquo;ll continue to document all of the features on this website, as well as improve the <a href="http://www.rubydoc.info/gems/rom">API reference docs</a>. If all goes well, we’re aiming for 1.0.0 to arrive in late summer (that’s around August or September for all of you folks who aren’t in the Northern Hemisphere!).</p>

<p>We&rsquo;re getting there! Thanks to everyone who’s helped out with testing, experimental features, bug reports, documentation and development so far. Try out 0.7.0, and let us know what you think.</p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2015/05/18/rom-0-7-0-released#disqus_thread">Leave a comment</a></li></ul></div><hr /></div></article><article><header><h1><a href="/blog/2015/04/04/rom-0-6-1-released">ROM 0.6.1 Released</a></h1><div class="article-meta">Published on April 04, 2015 by <a href="https://twitter.com/maetl">Mark Rickerby</a> under <a class="tag" href="/blog/tags/release/">release</a> <a class="tag" href="/blog/tags/announcement/">announcement</a></div></header><hr /><div class="article-body"><p>We’re pleased to announce that ROM 0.6.1 is now available, building on the <a href="/blog/2015/03/23/rom-0-6-0-released/">improvements and API changes in 0.6.0</a>.</p>

<p>This release includes updates of the following gems:</p>

<ul>
<li><a href="https://rubygems.org/gems/rom">rom 0.6.1</a> - <a href="https://github.com/rom-rb/rom/blob/master/CHANGELOG.md#v061-2015-04-04">changelog</a></li>
<li><a href="https://rubygems.org/gems/rom-sql">rom-sql 0.4.1</a> - <a href="https://github.com/rom-rb/rom-sql/blob/master/CHANGELOG.md#v041-2015-04-04">changelog</a></li>
<li><a href="https://rubygems.org/gems/rom-rails">rom-rails 0.3.1</a> - <a href="https://github.com/rom-rb/rom-rails/blob/master/CHANGELOG.md#v031-2015-04-04">changelog</a></li>
<li><a href="https://rubygems.org/gems/rom-lotus">rom-lotus 0.0.1</a> - <a href="https://github.com/rom-rb/rom-lotus/blob/master/CHANGELOG.md">changelog</a></li>
</ul>

<h2 id="auto-mapping-of-command-results">Auto-mapping of command results</h2>

<p>The results of commands can now be mapped in the same way as relations, using <code>as</code> or <code>map_with</code>.</p>
<pre class="highlight ruby"><code><span class="n">rom</span><span class="p">.</span><span class="nf">command</span><span class="p">(</span><span class="ss">:rel_name</span><span class="p">).</span><span class="nf">as</span><span class="p">(</span><span class="ss">:mapper_name</span><span class="p">)</span>
</code></pre>

<h2 id="new-migrations-interface">New migrations interface</h2>

<p>A database migration interface is now included in <code>rom-sql</code>. This is currently a thin wrapper around the excellent <a href="http://sequel.jeremyevans.net/rdoc/files/doc/migration_rdoc.html">Sequel Migrations API</a>.</p>

<p>You can use migrations with one or more repositories as follows:</p>
<pre class="highlight ruby"><code><span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span>
  <span class="ss">default: </span><span class="p">[</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'sqlite::memory'</span><span class="p">],</span>
  <span class="ss">other: </span><span class="p">[</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/test'</span><span class="p">]</span>
<span class="p">)</span>

<span class="no">ROM</span><span class="p">.</span><span class="nf">finalize</span>

<span class="no">ROM</span><span class="o">::</span><span class="no">SQL</span><span class="p">.</span><span class="nf">migration</span> <span class="k">do</span>
  <span class="n">change</span> <span class="k">do</span>
    <span class="n">create_table</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">primary_key</span> <span class="ss">:id</span>
      <span class="no">String</span> <span class="ss">:name</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># for a non-default repository</span>
<span class="no">ROM</span><span class="o">::</span><span class="no">SQL</span><span class="p">.</span><span class="nf">migration</span><span class="p">(</span><span class="ss">:other</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>

<p>The expected way to run migrations is to require the Rake task from <code>rom/sql/rake_task</code>, and provide a <code>db:setup</code> task that sets up the ROM connection.</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'sqlite3'</span>
<span class="nb">require</span> <span class="s1">'rom/sql/rake_task'</span>

<span class="n">namespace</span> <span class="ss">:db</span> <span class="k">do</span>
  <span class="n">task</span> <span class="ss">:setup</span> <span class="k">do</span>
    <span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'sqlite::memory'</span><span class="p">)</span>
    <span class="no">ROM</span><span class="p">.</span><span class="nf">finalize</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<h2 id="improvements-to-forms-for-rails-users">Improvements to forms for Rails users</h2>

<p>There are several new changes that rationalize and improve the usability of the Rails forms API:</p>

<ul>
<li>An optional <code>mappings</code> declaration has been added, which applies named mappers to the results of form commands.</li>
<li>Form generators can generate a shared base form class for new/update forms.</li>
<li><code>input</code> and <code>validations</code> blocks are now available in all descendants of <code>ROM::Model::Form</code>.</li>
</ul>

<p>The following example shows what this looks like in action, with base attributes and validations shared by the child classes, which each declare their own command, mapper, and attribute inputs:</p>
<pre class="highlight ruby"><code><span class="c1"># app/forms/user_form.rb</span>
<span class="k">class</span> <span class="nc">UserForm</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Form</span>
  <span class="n">input</span> <span class="k">do</span>
    <span class="n">set_model_name</span> <span class="s1">'User'</span>

    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">String</span>
    <span class="n">attribute</span> <span class="ss">:email</span><span class="p">,</span> <span class="no">String</span>
  <span class="k">end</span>

  <span class="n">validations</span> <span class="k">do</span>
    <span class="n">relation</span> <span class="ss">:users</span>

    <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
    <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># app/forms/new_user_form.rb</span>
<span class="k">class</span> <span class="nc">NewUserForm</span> <span class="o">&lt;</span> <span class="no">UserForm</span>
  <span class="n">commands</span> <span class="ss">users: :create</span>

  <span class="n">mappings</span> <span class="ss">users: :entity</span>

  <span class="n">input</span> <span class="k">do</span>
    <span class="n">timestamps</span><span class="p">(</span><span class="ss">:created_at</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">commit!</span>
    <span class="n">users</span><span class="p">.</span><span class="nf">try</span> <span class="p">{</span> <span class="n">users</span><span class="p">.</span><span class="nf">create</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># app/forms/update_user_form.rb</span>
<span class="k">class</span> <span class="nc">UpdateUserForm</span> <span class="o">&lt;</span> <span class="no">UserForm</span>
  <span class="n">commands</span> <span class="ss">users: :update</span>

  <span class="n">mappings</span> <span class="ss">users: :entity</span>

  <span class="n">input</span> <span class="k">do</span>
    <span class="n">timestamps</span><span class="p">(</span><span class="ss">:updated_at</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">commit!</span>
    <span class="n">users</span><span class="p">.</span><span class="nf">try</span> <span class="p">{</span> <span class="n">users</span><span class="p">.</span><span class="nf">update</span><span class="p">.</span><span class="nf">by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">).</span><span class="nf">set</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<h2 id="lotus-integration">Lotus integration</h2>

<p>And last but not least, <a href="https://github.com/rom-rb/rom-lotus">rom-lotus</a> is out shiny new integration with the <a href="http://lotusrb.org/">Lotus Framework</a>.</p>

<p>A very basic setup example:</p>
<pre class="highlight ruby"><code><span class="c1"># config/environment.rb</span>
<span class="nb">require</span> <span class="s1">'lotus/setup'</span>
<span class="nb">require</span> <span class="s1">'rom-lotus'</span>

<span class="nb">require_relative</span> <span class="s1">'../apps/web/application'</span>

<span class="no">Lotus</span><span class="o">::</span><span class="no">Container</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span>
  <span class="n">mount</span> <span class="no">Web</span><span class="o">::</span><span class="no">Application</span><span class="p">,</span> <span class="ss">at: </span><span class="s1">'/'</span>

  <span class="no">ROM</span><span class="o">::</span><span class="no">Lotus</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="no">Web</span><span class="o">::</span><span class="no">Application</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">setup</span><span class="o">|</span>
    <span class="n">setup</span><span class="p">.</span><span class="nf">repositories</span><span class="p">[</span><span class="ss">:default</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:sql</span><span class="p">,</span> <span class="s2">"sqlite:///tmp/test.sqlite"</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Expect to hear more about this as the integration evolves.</p>

<h2 id="upgrading-to-0-6-1">Upgrading to 0.6.1</h2>

<p>Please let us know if you have any trouble with the upgrade. Contact us directly via <a href="https://gitter.im/rom-rb/chat">Gitter</a> or <a href="https://github.com/rom-rb/rom/issues">submit an issue on GitHub</a> describing any problems you&rsquo;re having.</p>

<h2 id="onwards-to-0-7">Onwards to 0.7</h2>

<p>We’re planning to focus heavily on improvements to mappers and commands in 0.7, which should get us significantly closer to figuring out what the shape of these APIs will be in 1.0.</p>

<p>Thanks for your support!</p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2015/04/04/rom-0-6-1-released#disqus_thread">Leave a comment</a></li></ul></div><hr /></div></article><article><header><h1><a href="/blog/2015/03/23/rom-0-6-0-released">ROM 0.6.0 Released</a></h1><div class="article-meta">Published on March 23, 2015 by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> under <a class="tag" href="/blog/tags/release/">release</a> <a class="tag" href="/blog/tags/announcement/">announcement</a></div></header><hr /><div class="article-body"><p>We&rsquo;re happy to announce the final release of ROM 0.6.0! This version brings a lot of improvements and simplifies the internal architecture of ROM. There are over 700 commits between 0.5.0 and this release which is a result of fantastic feedback that we&rsquo;ve received from early adopters and many contributions from new people.</p>

<p>This release includes updates of the following gems:</p>

<ul>
<li><a href="https://rubygems.org/gems/rom">rom 0.6.0</a> - <a href="https://github.com/rom-rb/rom/blob/master/CHANGELOG.md#v060-2015-03-22">changelog</a></li>
<li><a href="https://rubygems.org/gems/rom-sql">rom-sql 0.4.0</a> - <a href="https://github.com/rom-rb/rom-sql/blob/master/CHANGELOG.md#v040-2015-03-22">changelog</a></li>
<li><a href="https://rubygems.org/gems/rom-rails">rom-rails 0.3.0</a> - <a href="https://github.com/rom-rb/rom-rails/blob/master/CHANGELOG.md#v040-2015-03-22">changelog</a></li>
<li><a href="https://rubygems.org/gems/rom-mongo">rom-mongo 0.1.0</a> - <a href="https://github.com/rom-rb/rom-mongo/blob/master/CHANGELOG.md#v040-2015-03-23">changelog</a></li>
</ul>

<p>The following new adapters have been released too:</p>

<ul>
<li><a href="https://rubygems.org/gems/rom-yesql">rom-yesql</a></li>
<li><a href="https://rubygems.org/gems/rom-csv">rom-csv</a></li>
<li><a href="https://rubygems.org/gems/rom-yaml">rom-yaml</a></li>
</ul>

<h2 id="class-based-setup">Class-based setup</h2>

<p>The biggest change in this release is the ability to define your own relation, mapper and command subclasses that ROM will instantiate for you and expose through its registry. The DSL-based setup is still available but using classes turned out to be a better approach in bigger contexts like web-applications.</p>

<p>Here&rsquo;s a simple Relation subclass definition:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:memory</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">by_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="n">restrict</span><span class="p">(</span><span class="ss">name: </span><span class="nb">name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<h2 id="lazy-relations-with-data-pipelining">Lazy-relations with data-pipelining</h2>

<p>Previous version of ROM had the concept of Reader which turned out to be confusing. After lots of discussions it was replaced by a new interface for accessing relations. This change makes mapping relations explicit as you need to provide the name of mapper(s) that you want to use when loading a relation.</p>

<p>Lazy relations can be used with any object that implements mapper interface but the simplest way to levarage this feature is to register ROM mappers for quick access:</p>
<pre class="highlight ruby"><code><span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:memory</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:memory</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">by_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="n">restrict</span><span class="p">(</span><span class="ss">name: </span><span class="nb">name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">UserMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">relation</span> <span class="ss">:users</span>
  <span class="n">register_as</span> <span class="ss">:entity</span>

  <span class="n">model</span> <span class="no">User</span>

  <span class="n">attribute</span> <span class="ss">:name</span>
<span class="k">end</span>

<span class="n">rom</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">user_entites</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">as</span><span class="p">(</span><span class="ss">:entity</span><span class="p">)</span>
<span class="n">user_entities</span><span class="p">.</span><span class="nf">by_name</span><span class="p">(</span><span class="s1">'Jane'</span><span class="p">)</span>
</code></pre>

<p>Thanks to data-pipelining feature you can send a relation through multiple mapping objects. This turned out to be very useful for decorating data:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">UserPresenterMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">relation</span> <span class="ss">:users</span>
  <span class="n">register_as</span> <span class="ss">:presenter</span>

  <span class="n">model</span> <span class="no">UserPresenter</span>
<span class="k">end</span>

<span class="n">user_presenter</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">as</span><span class="p">(</span><span class="ss">:entity</span><span class="p">,</span> <span class="ss">:presenter</span><span class="p">).</span><span class="nf">by_name</span><span class="p">(</span><span class="s1">'Jane'</span><span class="p">).</span><span class="nf">first</span>
</code></pre>

<p>On top of that there&rsquo;s also an experimental partial-application feature where you can grab a reference to a relation with partially applied arguments:</p>
<pre class="highlight ruby"><code><span class="n">users_by_name</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">as</span><span class="p">(</span><span class="ss">:entity</span><span class="p">).</span><span class="nf">by_name</span>

<span class="n">users_by_name</span><span class="p">[</span><span class="s1">'Jane'</span><span class="p">].</span><span class="nf">first</span>
</code></pre>

<h2 id="improved-and-simplified-command-interface">Improved and simplified command interface</h2>

<p>Commands are now composable and you can access them directly and call them. This makes it more obvious what&rsquo;s going on. We are still working on a generalized error/success handling that will be based on a 3rd party dependency since this is really out of ROM&rsquo;s scope.</p>

<p>You can define your commands using class interfaces too:</p>
<pre class="highlight ruby"><code><span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:memory</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">CreateUser</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Commands</span><span class="o">::</span><span class="no">Create</span><span class="p">[</span><span class="ss">:memory</span><span class="p">]</span>
  <span class="n">relation</span> <span class="ss">:users</span>
  <span class="n">register_as</span> <span class="ss">:create</span>
  <span class="n">result</span> <span class="ss">:one</span>
<span class="k">end</span>

<span class="n">rom</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">create_user</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">command</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">create</span>

<span class="n">rom</span><span class="p">.</span><span class="nf">command</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">try</span> <span class="p">{</span> <span class="n">create_user</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="ss">name: </span><span class="s1">'Jane'</span><span class="p">)</span> <span class="p">}</span>
</code></pre>

<p>Command API is growing quickly and more database-specific features will be implemented soon on top of existing functionality.</p>

<h2 id="improved-adapter-infrastructure">Improved adapter infrastructure</h2>

<p>Adapter infrastructure has been simplified so now an adapter can provide its <code>Repository</code> and <code>Relation</code> subclasses and register itself under specific identifier. It means that a ROM adapter is just a couple of extensions that allow you to use ROM with various data sources. If the adapter can work in full read/write mode it can also provide its own <code>Command</code> subclasses.</p>

<p>Setting up an adapter is now simpler too - ROM doesn&rsquo;t make <em>any assumptions</em> about repository instantiation and you can also instaniate it yourself and pass the instance to <code>ROM.setup</code>. This feature is already used by rom-rails where you can configure your repositories in an initializer if you don&rsquo;t want ROM to infer configuration from <code>database.yml</code>.</p>

<p>Another nice addition is a set of Lint tests that are useful for adapter creators. We even made the effort to make it work with both MiniTest and RSpec. Here are a couple of linters from the new CSV adapter:</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'rom/lint/spec'</span>

<span class="n">describe</span> <span class="no">ROM</span><span class="o">::</span><span class="no">CSV</span><span class="o">::</span><span class="no">Dataset</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:data</span><span class="p">)</span> <span class="p">{</span> <span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">2</span> <span class="p">}]</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:dataset</span><span class="p">)</span> <span class="p">{</span> <span class="no">ROM</span><span class="o">::</span><span class="no">CSV</span><span class="o">::</span><span class="no">Dataset</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it_behaves_like</span> <span class="s2">"a rom enumerable dataset"</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="no">ROM</span><span class="o">::</span><span class="no">CSV</span><span class="o">::</span><span class="no">Repository</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:repository</span><span class="p">)</span> <span class="p">{</span> <span class="no">ROM</span><span class="o">::</span><span class="no">CSV</span><span class="o">::</span><span class="no">Repository</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:uri</span><span class="p">)</span> <span class="p">{</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s1">'./spec/fixtures/users.csv'</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it_behaves_like</span> <span class="s2">"a rom repository"</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:identifier</span><span class="p">)</span> <span class="p">{</span> <span class="ss">:csv</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>ROM&rsquo;s adapter ecosystem is growing fast - we have <a href="https://github.com/rom-rb/rom-redis">Redis</a>, <a href="https://github.com/maetl/rom-neo4j">Neo4j</a> and <a href="https://github.com/rom-rb/rom-influxdb">InfluxDB</a> in the works already and <a href="https://github.com/rom-rb/rom/issues?q=is%3Aopen+is%3Aissue+label%3Aadapter+label%3Ahelp-wanted">more</a> are planned.</p>

<h2 id="form-objects-for-rails">Form objects for Rails</h2>

<p>This release also includes updates to rom-rails - the most notable change is the addition of <code>ROM::Model::Form</code> which allows you to define form objects that work nicely with ROM. It is using <code>Virtus</code> for params handling and <code>ActiveModel::Validations</code> for validations.</p>

<p>Our <a href="http://rom-rb.org/tutorials/todo-app-with-rails/">Rails tutorial</a> was updated too and explains how to use form objects in ROM. Here&rsquo;s an example of a simple form object definition:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">NewUserForm</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Form</span>
  <span class="n">commands</span> <span class="ss">users: :create</span>

  <span class="n">input</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">String</span>

    <span class="n">timestamps</span>
  <span class="k">end</span>

  <span class="n">validations</span> <span class="k">do</span>
    <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">commit!</span>
    <span class="n">users</span><span class="p">.</span><span class="nf">try</span> <span class="p">{</span> <span class="n">users</span><span class="p">.</span><span class="nf">create</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<h2 id="upgrading-from-0-5-0">Upgrading from 0.5.0</h2>

<p>The setup DSL works the same but you probably want to switch to class-based setup as it&rsquo;s easier to organize your code that way.</p>

<p>Please let us know if you have any trouble with the upgrade on our <a href="https://gitter.im/rom-rb/chat">gitter</a> channel or submit an issue describing problems you&rsquo;re having.</p>

<h2 id="about-1-0-0">About 1.0.0</h2>

<p>This has been amazing couple of months for ROM. The community is growing, we&rsquo;re seeing more and more people contributing to the project and geting great feedback from the real world usage.</p>

<p>Even though initially we planned to release 1.0.0 as soon as ROM proves itself on production, based on feedback from the community and discussing the release process we decided to give it few more months to push the first stable release.</p>

<p>We prefer to polish the interfaces and implement a bunch of important missing features that will make ROM simpler to use. In addition to features it&rsquo;s also important to provide great documentation and user guides, which is one of the priorities of 1.0.0 release.</p>

<h2 id="thank-you">Thank you!</h2>

<p>Thank you to all the early adopters and new contributors. This release would not be possible without your help! It&rsquo;s amazing to see how the project evolves thanks to you.</p>

<p>We have more great news, so stay tuned and watch this space :)</p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2015/03/23/rom-0-6-0-released#disqus_thread">Leave a comment</a></li></ul></div><hr /></div></article><article><header><h1><a href="/blog/2014/12/31/rom-0-5-0-released">ROM 0.5.0 Released</a></h1><div class="article-meta">Published on December 31, 2014 by <a href="https://twitter.com/elskwid">Don Morrison</a> under <a class="tag" href="/blog/tags/release/">release</a> <a class="tag" href="/blog/tags/announcement/">announcement</a></div></header><hr /><div class="article-body"><p>Today we&rsquo;re happy to announce the release of ROM version 0.5.0. It is the
culmination of months of hard work from a growing <a href="https://github.com/rom-rb/rom/network/members">team of contributors</a>.</p>

<p>It&rsquo;s exciting to end the year with such a large and meaningful release.</p>

<h2 id="how-we-got-here">How We Got Here</h2>

<p>There were some twists and turns along the way, not the least of which was
a reboot of the project with all new internals in November. The reboot was a
turning point that has allowed us to accelerate development while cementing
the core of ROM and surrounding libraries.</p>

<h2 id="version-0-5-0">Version 0.5.0</h2>

<p>The emphasis thus far has been on powerful mapping features and speed. This
has resulted in an interface that looks <em>lower-level</em> than the other projects
people use daily. We believe the higher-level and more convenient interfaces
will emerge with more real world use.</p>

<p>Many of the features and much of the polishing found in this release happened
as a direct result of ROM being used in production projects. In fact, one of
the larger realizations over the last several months has been that <strong>ROM is
not an ORM</strong>. I know. We were as surprised as you. Take some time to use it
and you&rsquo;ll see what we mean. The <a href="/tutorials/rails">Rails Tutorial</a> outlined
below is a great place to start.</p>

<p>There were so many things added, improved, replaced, refactored, and considered
both in the core of ROM and in libraries like <a href="https://github.com/rom-rb/rom-rails"><code>rom-rails</code></a> and
<a href="https://github.com/rom-rb/rom-sql"><code>rom-sql</code></a> that we can&rsquo;t cover them all here. See the changelog
section below for an overview of the changes and a link to the changelogs for
each project.</p>

<h2 id="rom-rb-org">rom-rb.org</h2>

<p>If you&rsquo;re reading this, it&rsquo;s because of the work we&rsquo;ve done updating the
website. Alongside the obvious layout and style changes we&rsquo;ve also spent
time on <a href="/introduction">introductions</a> and <a href="/tutorials">tutorials</a>.</p>

<h3 id="introductions">Introductions</h3>

<p>The <a href="/introduction">introductions</a> are here to help you get accustomed to the
terms and concepts used throughout ROM. You&rsquo;ll also find a brief article on
<a href="/introduction/why">Why ROM</a> and a short comparision with <a href="/introduction/activerecord">ActiveRecord</a>.</p>

<h3 id="tutorials">Tutorials</h3>

<p>We&rsquo;ve put together a fairly thorough tutorial for getting started with
<a href="/tutorials/rails">ROM and Rails</a> and have several more planned. Even if you
don&rsquo;t use Rails, this tutorial can help you understand how many of the ideas
in ROM come together to create powerful ways of working with data.</p>

<p>There will be more <a href="/tutorials">tutorials</a> in the coming weeks.</p>

<h2 id="rom-v0-5-0-changelog-summary">[rom] v0.5.0 Changelog summary:</h2>

<ul>
<li><p>Major milestone of putting together relation and mapping layers is done.
ROM runs on a pluggable data mapping backends now. The first one is built-in
and is based on a new library called <a href="https://github.com/solnic/transproc">transproc</a>. More will
come soon as the need arises.</p></li>
<li><p>Mapping is much more powerful now, support for prefixing keys, symbolizing
keys, wrapping, grouping, embeddeding and coercions was added. In addition to
that wrap, group and embedded can be nested which allows you to build very rich
aggregate objects</p></li>
<li><p>Reading can only be used with defined relations now, which adheres to one of
the core concepts in rom that data access should be restricted and encapsulated
in the relation layer.</p></li>
<li><p>Adapter interface was improved and extended with extra options that can be used
to build powerful adapters setup interface was improved and now accepts a
simple URI string or a database.yml-complaint hash, makes it easier to use
rom standalone and/or integrate with other libs and frameworks.</p></li>
<li><p>Relations that are not used by readers don&rsquo;t have to be defined now, it will be
done automatically based on schema. This simplifies setup process every relation
has access to all other relations (previously those were &ldquo;raw&rdquo; datasets from
adapters). This allows you to reuse your relations inside. Well, relations.</p></li>
<li><p>Lots of internal improvements that should make using rom a nicer experience.</p></li>
<li><p>It remains very fast. Still lots of opportunities to tune it but not a big
priority right now.</p></li>
</ul>

<p><a href="https://github.com/rom-rb/rom/blob/v0.5.0/CHANGELOG.md">Full changelog</a></p>

<h2 id="rom-rails-v0-2-0-changelog-summary">[rom-rails] v0.2.0 Changelog summary:</h2>

<ul>
<li><p>We have now generators for relations, mappers and commands!</p></li>
<li><p>Convenient validation and params processing extensions were added to make it
easier to switch from AR to ROM in rails apps.</p></li>
<li><p>Support for hot-reloading in development env (works with spring!)</p></li>
<li><p>Support for more connection options (as a result of the general improvements
in adapter interface)</p></li>
</ul>

<p><a href="https://github.com/rom-rb/rom-rails/blob/v0.2.0/CHANGELOG.md">Full changelog</a></p>

<h2 id="rom-demo-updated">[rom-demo] Updated:</h2>

<ul>
<li>Was updated to work with the latest ROM. You can see a GitHub adapter with
some advanced mapping.</li>
</ul>

<p><a href="https://github.com/solnic/rom-demo">Latest rom-demo</a></p>

<h2 id="rom-sql-v0-3-1-changelog-summary">[rom-sql] v0.3.1 Changelog summary:</h2>

<ul>
<li>Support for changes to ROM options and Rails reloading.</li>
</ul>

<p><a href="https://github.com/rom-rb/rom-sql/blob/v0.3.1/CHANGELOG.md">Full changelog</a></p>

<h2 id="new-adapters">New adapters:</h2>

<p>As mentioned before there are a couple of small adapters in the works:
<a href="https://github.com/rom-rb/rom-yaml"><code>rom-yaml</code></a> and <a href="https://github.com/rom-rb/rom-csv"><code>rom-csv</code></a> with more planned.</p>

<h2 id="onward-towards-rom-1-0-0">Onward towards ROM 1.0.0</h2>

<p>Version 0.5.0 is a milestone on the journey to 1.0.0. There&rsquo;s nothing magical
about a one-dot-oh but wouldn&rsquo;t it be nice?</p>

<p>For 1.0.0 there are no major changes planned. We will focus on polishing and new
features like transactions in <a href="https://github.com/rom-rb/rom-sql"><code>rom-sql</code></a> and an extended command
interface. There will be lots of internal small refactorings, improvements in
the spec suite to bring a more unit-based approach now that interfaces are
stabilizing, features based on feedback, and fixes for any bugs that come our
way.</p>

<h3 id="you-can-help">You can help</h3>

<p>Yes, you can! As with all projects <em>&ldquo;many hands make light work&rdquo;</em>. You don&rsquo;t
have to jump in and tackle core issues, of course you can, but there are many
ways you can help us out:</p>

<h4 id="try-it-out">Try it out</h4>

<p>Take it for a test drive. Drop it in to an existing project or create a new
special little place just for ROM to live. The only requirement is that you come
back and tell us what you think. Like. Dislike. We want to hear it all.</p>

<h4 id="tell-us-how-you-39-re-using-rom">Tell us how you&rsquo;re using ROM</h4>

<p>You may already be building things with ROM and we&rsquo;d love to hear about it. What
are you making? How is it working for you?  What interfaces have you created to
make common work easier? This feedback can greatly improve the project for
everyone.</p>

<h4 id="documentation">Documentation</h4>

<p>[dramatic pause] We all love it when it&rsquo;s written but who writes it? We do. When
you&rsquo;re trying out ROM and you find something doesn&rsquo;t make sense &ndash; just create an
issue on the repo. You could even assign it to yourself and make it better.
(Imagine the satisfaction&hellip;)</p>

<h4 id="tutorials">Tutorials</h4>

<p>Follow a tutorial. Well, since there is only one at the time of this announcement
perhaps we should say &ldquo;follow THE tutorial&rdquo;. Go through it and see what you make
of it. If you find yourself using ROM differently, like in another framework,
create a short tutorial about it. We can even help with the writing if you need
it.</p>

<h4 id="write-adapters">Write adapters</h4>

<p>There are a couple of simple adapters in progress. Both
<a href="https://github.com/rom-rb/rom-yaml"><code>rom-yaml</code></a> and <a href="https://github.com/rom-rb/rom-csv"><code>rom-csv</code></a> are about as easy as
they get. Maybe you could write <code>rom-json</code> or <code>rom-NEWDB</code>. We can help with this
as well. Get it started and we&rsquo;ll all chip in.</p>

<h4 id="find-your-own-way">Find your own way</h4>

<p>We truly believe there are as many ways to help as there people. Take a look
around, chat with us on <a href="https://gitter.im/rom-rb/chat">Gitter</a> and get to it.</p>

<p><strong>Thanks for reading and here&rsquo;s to a great 2015!</strong></p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2014/12/31/rom-0-5-0-released#disqus_thread">Leave a comment</a></li></ul></div><hr /></div></article><script>var disqus_shortname = 'rom-rb-blog';

(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());</script></section></div><div class="col-md-4"><aside><div class="blog-sidebar panel panel-default"><div class="panel-heading"><div class="panel-title">Wherein we talk about ROM</div></div><div class="panel-body"><a class="subscribe btn btn-info" href="http://rom-rb.org/blog/feed.xml">Subscribe</a></div></div><div class="tag-sidebar panel panel-default"><div class="panel-heading"><div class="panel-title">Browse tags</div></div><ul class="blog-tags"><li><span class="badge">5</span><a href="/blog/tags/release/">release</a></li><li><span class="badge">9</span><a href="/blog/tags/announcement/">announcement</a></li><li><span class="badge">1</span><a href="/blog/tags/oss/">oss</a></li><li><span class="badge">1</span><a href="/blog/tags/support/">support</a></li></ul></div></aside></div></div></div></div></div></div><footer><div class="container"><div class="social"><div class="github"><iframe allowtransparency="true" frameborder="0" height="20" scrolling="0" src="http://ghbtns.com/github-btn.html?user=rom-rb&repo=rom&type=watch&count=true" width="110"></iframe></div><div class="twitter"><a class="twitter-follow-button" data-show-count="true" data-show-screen-name="false" href="https://twitter.com/rom_rb">Follow</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></div></div><div class="muted copyright">Ruby Object Mapper &copy; 2014-2016</div></div></footer></body></html>