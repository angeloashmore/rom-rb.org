<!DOCTYPE html><html><head><link href="/images/favicon.png" rel="icon" type="image/png" /><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="ROM &raquo; Blog &raquo; ROM 0.8.0 Released via @rom_rb" name="twitter:description" /><meta content="ROM &raquo; Blog &raquo; ROM 0.8.0 Released" name="description" /><title>ROM &raquo; Blog &raquo; ROM 0.8.0 Released</title><style type="text/css">.highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #d0d0d0;
  background-color: #151515;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}</style><link href="../../../../../stylesheets/all.css" rel="stylesheet" /><script src="../../../../../javascripts/all.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script><script>$(function() {
  var share = new Share(".share")
});
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-2573270-5', 'auto');
ga('send', 'pageview');</script></head><body class="blog blog_2015 blog_2015_06 blog_2015_06_22 blog_2015_06_22_rom-0-8-0-released blog_2015_06_22_rom-0-8-0-released_index"><div class="page-wrapper"><header><nav class="navbar navbar-default navbar-static-top"><div class="navbar-inner"><div class="container"><a class="navbar-brand" href="/">Ruby Object Mapper</a><ul class="nav navbar-nav"><li class=""><a class="" href="/learn">Learn</a></li><li class="dropdown"><a class="dropdown-toggle" role="button" data-toggle="dropdown" href="#">API <span class='caret'/></a><ul class="dropdown-menu" role="menu"><li><a href="http://www.rubydoc.info/gems/rom">rom</a></li><li><a href="http://www.rubydoc.info/gems/rom-cassandra">rom-cassandra</a></li><li><a href="http://www.rubydoc.info/gems/rom-couchdb">rom-couchdb</a></li><li><a href="http://www.rubydoc.info/gems/rom-csv">rom-csv</a></li><li><a href="http://www.rubydoc.info/gems/rom-dm">rom-dm</a></li><li><a href="http://www.rubydoc.info/gems/rom-event_store">rom-event_store</a></li><li><a href="http://www.rubydoc.info/gems/rom-git">rom-git</a></li><li><a href="http://www.rubydoc.info/gems/rom-http">rom-http</a></li><li><a href="http://www.rubydoc.info/gems/rom-influxdb">rom-influxdb</a></li><li><a href="http://www.rubydoc.info/gems/rom-json">rom-json</a></li><li><a href="http://www.rubydoc.info/gems/rom-kafka">rom-kafka</a></li><li><a href="http://www.rubydoc.info/gems/rom-lotus">rom-lotus</a></li><li><a href="http://www.rubydoc.info/gems/rom-mongo">rom-mongo</a></li><li><a href="http://www.rubydoc.info/gems/rom-neo4j">rom-neo4j</a></li><li><a href="http://www.rubydoc.info/gems/rom-rails">rom-rails</a></li><li><a href="http://www.rubydoc.info/gems/rom-redis">rom-redis</a></li><li><a href="http://www.rubydoc.info/gems/rom-rethinkdb">rom-rethinkdb</a></li><li><a href="http://www.rubydoc.info/gems/rom-roda">rom-roda</a></li><li><a href="http://www.rubydoc.info/gems/rom-sql">rom-sql</a></li><li><a href="http://www.rubydoc.info/gems/rom-yaml">rom-yaml</a></li><li><a href="http://www.rubydoc.info/gems/rom-yesql">rom-yesql</a></li></ul></li><li class=""><a class="" href="/blog">Blog</a></li><li class=""><a class="" href="/contribute">Contribute</a></li><li class=""><a class="" href="/status">Status</a></li><li class=""><a class="" href="/backers">Backers <3</a></li></ul></div></div></nav></header><div class="container"><div class="content"><div class="blog"><div class="row"><div class="col-md-8"><section class="articles"><article><header><h1>ROM 0.8.0 Released</h1><div class="article-meta">Published on June 22, 2015 by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> under <a class="tag" href="/blog/tags/release/">release</a> <a class="tag" href="/blog/tags/announcement/">announcement</a></div></header><hr /><div class="article-body"><p>We&rsquo;re very happy to announce the release of Ruby Object Mapper 0.8.0. This release ships with the support for nested input for commands and many improvements in mappers. You can look at <a href="https://github.com/rom-rb/rom/blob/master/CHANGELOG.md#v070-2015-06-22">the changelog</a> for the full overview.</p>

<p>Apart from ROM 0.8.0 release there are also updates of the following gems:</p>

<ul>
<li>rom-sql 0.5.2 which comes with improved migration tasks that no longer require env finalization <a href="https://github.com/rom-rb/rom-sql/blob/master/CHANGELOG.md#v070-2015-06-22">CHANGELOG</a></li>
<li>rom-rails 0.4.0 with the support for embedded validators <a href="https://github.com/rom-rb/rom-rails/blob/master/CHANGELOG.md#v070-2015-06-22">CHANGELOG</a></li>
</ul>

<p>There are 2 new adapters added to the rom-rb organization so check them out:</p>

<ul>
<li><a href="https://github.com/rom-rb/rom-couchdb">rom-couchdb</a></li>
<li><a href="https://github.com/rom-rb/rom-git">rom-git</a></li>
</ul>

<h2 id="support-for-nested-input">Support For Nested Input</h2>

<p>ROM commands are now even more powerful by allowing composition of multiple commands into one that can receive a nested input which will be used to insert data into multiple relations. This feature is compatible with combined relation mapping which means you can pipe results from a combined command through mappers just like in case of combined relations.</p>

<p>When do you want to use this feature? Every time you want to persist entire object graph, in example a post with its tags or a user with an address.</p>

<p>Here&rsquo;s a complete example of using combined commands with a mapper:</p>
<pre class="highlight ruby"><code><span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/rom'</span><span class="p">)</span>

<span class="no">ROM</span><span class="o">::</span><span class="no">SQL</span><span class="p">.</span><span class="nf">gateway</span><span class="p">.</span><span class="nf">connection</span><span class="p">.</span><span class="nf">create_table</span> <span class="ss">:posts</span> <span class="k">do</span>
  <span class="n">primary_key</span> <span class="ss">:id</span>
  <span class="n">column</span> <span class="ss">:title</span><span class="p">,</span> <span class="no">String</span>
<span class="k">end</span>

<span class="no">ROM</span><span class="o">::</span><span class="no">SQL</span><span class="p">.</span><span class="nf">gateway</span><span class="p">.</span><span class="nf">connection</span><span class="p">.</span><span class="nf">create_table</span> <span class="ss">:tags</span> <span class="k">do</span>
  <span class="n">primary_key</span> <span class="ss">:id</span>
  <span class="n">foreign_key</span> <span class="ss">:post_id</span><span class="p">,</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="n">column</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">String</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Posts</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Tags</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">CreatePost</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Commands</span><span class="o">::</span><span class="no">Create</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">relation</span> <span class="ss">:posts</span>
  <span class="n">result</span> <span class="ss">:one</span>
  <span class="n">register_as</span> <span class="ss">:create</span>
  <span class="n">input</span> <span class="no">Transproc</span><span class="p">(</span><span class="ss">:accept_keys</span><span class="p">,</span> <span class="p">[</span><span class="ss">:title</span><span class="p">])</span> <span class="c1"># filters out `:tags` key</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">CreateTag</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Commands</span><span class="o">::</span><span class="no">Create</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">relation</span> <span class="ss">:tags</span>
  <span class="n">register_as</span> <span class="ss">:create</span>
  <span class="n">input</span> <span class="no">Transproc</span><span class="p">(</span><span class="ss">:accept_keys</span><span class="p">,</span> <span class="p">[</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:post_id</span><span class="p">])</span>
  <span class="n">associates</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">key: </span><span class="p">[</span><span class="ss">:post_id</span><span class="p">,</span> <span class="ss">:id</span><span class="p">]</span> <span class="c1"># automatically sets FK value</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">PostMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">relation</span> <span class="ss">:posts</span>
  <span class="n">register_as</span> <span class="ss">:entity</span>

  <span class="n">combine</span> <span class="ss">:tags</span><span class="p">,</span> <span class="ss">on: </span><span class="p">{</span> <span class="ss">id: :post_id</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">rom</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">create_post_with_tags</span> <span class="o">=</span> <span class="n">rom</span>
  <span class="p">.</span><span class="nf">command</span><span class="p">([{</span> <span class="ss">post: :posts</span> <span class="p">},</span> <span class="p">[</span><span class="ss">:create</span><span class="p">,</span> <span class="p">[</span><span class="ss">:tags</span><span class="p">,</span> <span class="p">[</span><span class="ss">:create</span><span class="p">]]]])</span>
  <span class="p">.</span><span class="nf">as</span><span class="p">(</span><span class="ss">:entity</span><span class="p">)</span>

<span class="n">create_post_with_tags</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
  <span class="ss">post: </span><span class="p">{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">tags: </span><span class="p">[{</span> <span class="ss">name: </span><span class="s1">'red'</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s1">'green'</span> <span class="p">}]</span> <span class="p">}</span>
<span class="p">).</span><span class="nf">to_a</span>
<span class="c1"># [</span>
<span class="c1">#   {</span>
<span class="c1">#     :id =&gt; 1,</span>
<span class="c1">#     :title =&gt; "Hello World",</span>
<span class="c1">#     :tags =&gt; [</span>
<span class="c1">#       { :id=&gt;1, :post_id=&gt;1, :name=&gt;"red" },</span>
<span class="c1">#       { :id=&gt;2, :post_id=&gt;1, :name=&gt;"green" }</span>
<span class="c1">#      ]</span>
<span class="c1">#   }</span>
<span class="c1"># ]</span>
</code></pre>

<h2 id="mapper-steps">Mapper Steps</h2>

<p>Transforming data with mappers can be really complex and sometimes you may want to define multiple mapping steps. That&rsquo;s why we introduced a new interface in Mapper DSL where you can do just that:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">UserMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">step</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">from: :user_id</span>
    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">from: :user_name</span>
  <span class="k">end</span>

  <span class="n">step</span> <span class="k">do</span>
    <span class="n">wrap</span> <span class="ss">:details</span> <span class="k">do</span>
      <span class="n">attribute</span> <span class="ss">:name</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="no">UserMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="n">mapper</span><span class="p">.</span><span class="nf">call</span><span class="p">([{</span> <span class="ss">user_id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">user_name: </span><span class="s1">'Jane'</span> <span class="p">}])</span>
<span class="c1"># [{ :id =&gt; 1, :details =&gt; { :name =&gt; "Jane" } }]</span>
</code></pre>

<p>Typically you want to use this feature when mapping logic is too complex to be expressed using nested blocks. It&rsquo;s especially useful when dealing with multiple group/ungroup/wrap/unwrap/fold/unfold operations that simply cannot be defined as a deeply nested mapping definition block.</p>

<h2 id="new-mapping-transformations">New Mapping Transformations</h2>

<p>We have 3 new transformations <code>fold</code>, <code>unfold</code> and <code>ungroup</code> which makes mappers even more powerful.</p>

<p>Folding can be used to collapse values from multiple tuples under a single array attribute:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">PostFoldMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">fold</span> <span class="ss">tag_list: </span><span class="p">[</span><span class="ss">:tag_name</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="no">PostFoldMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="nb">puts</span> <span class="n">mapper</span><span class="p">.</span><span class="nf">call</span><span class="p">([</span>
  <span class="p">{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">tag_name: </span><span class="s1">'red'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">tag_name: </span><span class="s1">'green'</span> <span class="p">}</span>
<span class="p">]).</span><span class="nf">inspect</span>
<span class="c1"># [{:title=&gt;"Hello World", :tag_list=&gt;["red", "green"]}]</span>
</code></pre>

<p>Unfolding is, unsurprisingly, an inversion of folding:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">PostUnfoldMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">unfold</span> <span class="ss">:tag_name</span><span class="p">,</span> <span class="ss">from: :tag_list</span>
<span class="k">end</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="no">PostUnfoldMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="nb">puts</span> <span class="n">mapper</span><span class="p">.</span><span class="nf">call</span><span class="p">([{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">tag_list: </span><span class="p">[</span><span class="s1">'red'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">]</span> <span class="p">}]).</span><span class="nf">inspect</span>
<span class="c1"># [{:tag_name=&gt;"red", :title=&gt;"Hello World"}, {:tag_name=&gt;"green", :title=&gt;"Hello World"}]</span>
</code></pre>

<p>Now you can also ungroup tuples:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">PostUngroupMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">ungroup</span> <span class="ss">:tags</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:tag_name</span><span class="p">,</span> <span class="ss">from: :name</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">mapper</span> <span class="o">=</span> <span class="no">PostUngroupMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="nb">puts</span> <span class="n">mapper</span><span class="p">.</span><span class="nf">call</span><span class="p">([</span>
  <span class="p">{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">tags: </span><span class="p">[{</span> <span class="ss">name: </span><span class="s1">'red'</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s1">'green'</span> <span class="p">}]</span> <span class="p">}</span>
<span class="p">]).</span><span class="nf">inspect</span>
<span class="c1"># [{:tag_name=&gt;"red", :title=&gt;"Hello World"}, {:tag_name=&gt;"green", :title=&gt;"Hello World"}]</span>
</code></pre>

<h2 id="guides">Guides</h2>

<p>ROM is growing really fast and there&rsquo;s a lot of functionality that is difficult to describe in API documentation. That&rsquo;s why we started a new <a href="http://rom-rb.org/guides">Guides</a> section on the official rom-rb.org website.</p>

<p>You can already find a lot of information about ROM setup, adapters, relations, commands and mappers. We&rsquo;ll be adding more content and improving existing documentation based on the feedback so please check them out and let us know what you think.</p>

<p>In the upcoming weeks you should also see new tutorials covering topics like building your own persistence layer with ROM, handling data import with ROM or how to use ROM with various JSON serializers like Roar or Yaks, so stay tuned!</p>

<h2 id="next-release">Next Release</h2>

<p>We have a pretty good understanding of what we want to achieve with the next 0.9.0 release which will improve the internal architecture of ROM. We&rsquo;re planning to split <code>rom</code> gem into <a href="https://github.com/rom-rb/rom/issues/256">smaller pieces</a> and introduce cleaner and more explicit interfaces for setting up ROM.</p>

<p>Another planned change is introducing <a href="https://github.com/rom-rb/rom/issues/193">Policy Over Configuration</a> API which should improve ROM configuration and handling various conventions.</p>

<p>This release will be a big step towards 1.0.0 which is scheduled for September (yes, this year ;)).</p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2015/06/22/rom-0-8-0-released#disqus_thread">Leave a comment</a></li></ul></div><hr /><div class="article-comments"><div id="disqus_thread"><script>/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'rom-rb-blog'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script></div></div></div></article></section></div><div class="col-md-4"><aside><div class="blog-sidebar panel panel-default"><div class="panel-heading"><div class="panel-title">Wherein we talk about ROM</div></div><div class="panel-body"><a class="subscribe btn btn-info" href="http://rom-rb.org/blog/feed.xml">Subscribe</a></div></div><div class="tag-sidebar panel panel-default"><div class="panel-heading"><div class="panel-title">Browse tags</div></div><ul class="blog-tags"><li><span class="badge">5</span><a href="/blog/tags/release/">release</a></li><li><span class="badge">9</span><a href="/blog/tags/announcement/">announcement</a></li><li><span class="badge">1</span><a href="/blog/tags/oss/">oss</a></li><li><span class="badge">1</span><a href="/blog/tags/support/">support</a></li></ul></div></aside></div></div></div></div></div></div><footer><div class="container"><div class="social"><div class="github"><iframe allowtransparency="true" frameborder="0" height="20" scrolling="0" src="http://ghbtns.com/github-btn.html?user=rom-rb&repo=rom&type=watch&count=true" width="110"></iframe></div><div class="twitter"><a class="twitter-follow-button" data-show-count="true" data-show-screen-name="false" href="https://twitter.com/rom_rb">Follow</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></div></div><div class="muted copyright">Ruby Object Mapper &copy; 2014-2016</div></div></footer></body></html>